<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Day 11 ‚Äî IaC Security Scanning</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="shared.css">
</head>
<body>
<div class="shell">
<nav class="sidebar">
  <div class="sidebar-header">
    <div class="day-badge">Week 2 ¬∑ Day 11</div>
    <h2>IaC Security<br>Scanning</h2>
    <div class="sidebar-meta"><span class="chip">Policy-as-Code</span><span class="chip">4 lessons</span><span class="chip">1 lab</span><span class="chip">~4h</span></div>
  </div>
  <div class="sidebar-back">
    <a class="back-index" href="../index.html">
      <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M7.5 2L3.5 6L7.5 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Course Index
    </a>
    <div class="week-jumps-label">Jump to week</div>
    <div class="week-jumps">
      <a class="week-jump wj1" href="../index.html#week-1">W1</a>
      <a class="week-jump wj2" href="../index.html#week-2">W2</a>
      <a class="week-jump wj3" href="../index.html#week-3">W3</a>
      <a class="week-jump wj4" href="../index.html#week-4">W4</a>
    </div>
    <div class="day-nav-label">Week 2 days</div>
    <div class="day-nav">
      <a class="day-link" href="day-08.html">D8</a>
      <a class="day-link" href="day-09.html">D9</a>
      <a class="day-link" href="day-10.html">D10</a>
      <a class="day-link current" href="day-11.html">D11</a>
      <a class="day-link" href="day-12.html">D12</a>
      <a class="day-link" href="day-13.html">D13</a>
      <a class="day-link" href="day-14.html">D14</a>
    </div>
  </div>

  <div class="lesson-nav">
    <div class="nav-group-label">Lessons</div>
    <div class="nav-item active" onclick="goTo(0)"><span class="nav-num">01</span><span class="nav-label">Shift-Left Security</span><span class="nav-check">‚úì</span></div>
    <div class="nav-item" onclick="goTo(1)"><span class="nav-num">02</span><span class="nav-label">CloudFormation Security Patterns</span><span class="nav-check">‚úì</span></div>
    <div class="nav-item" onclick="goTo(2)"><span class="nav-num">03</span><span class="nav-label">Checkov: Static Analysis</span><span class="nav-check">‚úì</span></div>
    <div class="nav-item" onclick="goTo(3)"><span class="nav-num">04</span><span class="nav-label">CI/CD Security Gates</span><span class="nav-check">‚úì</span></div>
    <div class="nav-group-label" style="margin-top:8px">Lab</div>
    <div class="nav-item lab-item" onclick="goTo(4)"><span class="nav-num" style="color:var(--lab)">üî¨</span><span class="nav-label">Hands-on: Checkov + CloudFormation</span><span class="nav-check">‚úì</span></div>
  </div>
  <div class="sidebar-footer">
    <div class="progress-label"><span>Progress</span><span id="progress-pct">0 / 5</span></div>
    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
  </div>
</nav>
<div class="main">
  <div class="lesson-topbar">
    <div class="lesson-crumb">Day 11 &nbsp;/&nbsp; <span id="topbar-title">Shift-Left Security</span></div>
    <div class="nav-arrows">
      <button class="arrow-btn" id="btn-prev" onclick="prev()" disabled>‚Üê Prev</button>
      <button class="arrow-btn" id="btn-next" onclick="next()">Next ‚Üí</button>
    </div>
  </div>

  <!-- LESSON 1 -->
  <div class="lesson-pane active" id="pane-0">
    <div class="lesson-tag tag-concept">Concept</div>
    <h1>Shift-Left<br><em>Security</em></h1>
    <p><strong>Objective:</strong> Understand why finding misconfigurations in infrastructure code before deployment is dramatically cheaper and faster than finding them in production.</p>
    <p>Traditional security operated at the <strong>right side</strong> of the development lifecycle ‚Äî after code was written, after infrastructure was deployed, after the product went live. The CISO would run a scan, find 400 issues, and hand a spreadsheet to a team who had already moved on to the next project.</p>
    <p><strong>Shift-Left</strong> moves security checks to the earliest possible moment: when the infrastructure code is written, before anything is deployed. This is where IaC (Infrastructure as Code) scanning lives.</p>
    <div class="shift-left">
      <div class="sl-stage highlighted">
        <div class="sl-name">Code</div>
        <div class="sl-cost cheap">$0</div>
        <div class="sl-desc">Fix in template ‚Äî 30 seconds</div>
      </div>
      <div class="sl-stage">
        <div class="sl-name">PR Review</div>
        <div class="sl-cost cheap">~$10</div>
        <div class="sl-desc">Code review + discussion</div>
      </div>
      <div class="sl-stage">
        <div class="sl-name">Staging</div>
        <div class="sl-cost" style="color:var(--amber)">~$100</div>
        <div class="sl-desc">Re-deploy + retest cycle</div>
      </div>
      <div class="sl-stage">
        <div class="sl-name">Production</div>
        <div class="sl-cost expensive">~$10k+</div>
        <div class="sl-desc">Breach, audit, rework</div>
      </div>
    </div>
    <p>The <strong>highlighted stage</strong> is where Checkov and similar tools operate. Find a misconfigured S3 bucket in a CloudFormation template? Fix it in 30 seconds. Find the same misconfigured bucket after a data breach? That's a $4.88M average cost (IBM 2025).</p>
    <div class="callout insight"><div class="callout-title">üí° Policy-as-Code Defined</div>Policy-as-Code means encoding security rules as machine-readable policies that can be automatically evaluated against infrastructure definitions. Instead of a human reviewing 10,000 lines of CloudFormation, a tool checks every resource against 1,000+ rules in seconds ‚Äî and fails the build if anything violates policy.</div>
    <div class="callout breach"><div class="callout-title">Real-World Context</div>The 2019 Capital One breach originated from a misconfigured WAF ‚Äî a single missing configuration setting in their infrastructure. IaC scanning would have flagged this before deployment. PCI DSS 4.0 Requirement 6.4.3 now explicitly requires IaC scanning for organisations that deploy infrastructure via code.</div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">Your team uses CloudFormation to deploy all infrastructure. A developer accidentally creates an S3 bucket with public read access. When is the cheapest moment to catch and fix this?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,0)"><span class="opt-key">A</span>During the weekly Security Hub findings review, after deployment to staging</button>
        <button class="kcheck-opt" onclick="check(this,true,0)"><span class="opt-key">B</span>In the CI/CD pipeline, when the CloudFormation template is pushed ‚Äî before any deployment occurs</button>
        <button class="kcheck-opt" onclick="check(this,false,0)"><span class="opt-key">C</span>After deployment to production, using AWS Config to detect the misconfiguration</button>
        <button class="kcheck-opt" onclick="check(this,false,0)"><span class="opt-key">D</span>During the quarterly penetration test when the exposed bucket is discovered</button>
      </div>
      <div class="kcheck-feedback" id="fb-0"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" disabled>‚Üê Previous</button><button class="next-btn" onclick="next()">Next Lesson ‚Üí</button></div>
  </div>

  <!-- LESSON 2 -->
  <div class="lesson-pane" id="pane-1">
    <div class="lesson-tag tag-security">Security Patterns</div>
    <h1>CloudFormation<br><em>Security Patterns</em></h1>
    <p><strong>Objective:</strong> Learn the most common CloudFormation misconfigurations ‚Äî the things IaC scanners look for ‚Äî and understand the secure alternatives.</p>
    <p>CloudFormation templates describe your entire AWS infrastructure as YAML or JSON. A misconfigured template doesn't just affect one resource ‚Äî it can be deployed hundreds of times across accounts and regions, multiplying the risk.</p>
    <table class="check-table">
      <thead><tr><th>Resource</th><th>Common Misconfiguration</th><th>Secure Pattern</th></tr></thead>
      <tbody>
        <tr><td>S3 Bucket</td><td style="color:#8a92a8">No <code>BlockPublicAcls</code>, no encryption</td><td style="color:#7ec88c;font-size:12px">BlockPublicAcls: true + ServerSideEncryption: AES256</td></tr>
        <tr><td>Security Group</td><td style="color:#8a92a8">Inbound 0.0.0.0/0 on port 22 (SSH)</td><td style="color:#7ec88c;font-size:12px">Restrict to specific IP ranges or use Session Manager</td></tr>
        <tr><td>RDS Instance</td><td style="color:#8a92a8">PubliclyAccessible: true, no encryption</td><td style="color:#7ec88c;font-size:12px">PubliclyAccessible: false + StorageEncrypted: true</td></tr>
        <tr><td>IAM Role</td><td style="color:#8a92a8">Action: "*" / Resource: "*" (wildcard)</td><td style="color:#7ec88c;font-size:12px">Least privilege ‚Äî specific actions and resources</td></tr>
        <tr><td>CloudTrail</td><td style="color:#8a92a8">No log file validation, single region only</td><td style="color:#7ec88c;font-size:12px">EnableLogFileValidation: true + IsMultiRegionTrail: true</td></tr>
        <tr><td>Lambda</td><td style="color:#8a92a8">Execution role with AdministratorAccess</td><td style="color:#7ec88c;font-size:12px">Scoped role ‚Äî only the services the function calls</td></tr>
      </tbody>
    </table>
    <p>Here's a minimal secure S3 bucket in CloudFormation ‚Äî every property here corresponds to a Checkov check:</p>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">YAML ‚Äî CloudFormation</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre><span class="key">SecureBucket</span>:
  <span class="hl">Type</span>: <span class="str">AWS::S3::Bucket</span>
  <span class="hl">Properties</span>:
    <span class="hl2">BucketEncryption</span>:
      <span class="hl">ServerSideEncryptionConfiguration</span>:
        - <span class="hl">ServerSideEncryptionByDefault</span>:
            <span class="hl">SSEAlgorithm</span>: <span class="str">AES256</span>    <span class="comment"># CKV_AWS_53</span>
    <span class="hl2">PublicAccessBlockConfiguration</span>:
      <span class="hl">BlockPublicAcls</span>: <span class="str">true</span>       <span class="comment"># CKV_AWS_55</span>
      <span class="hl">BlockPublicPolicy</span>: <span class="str">true</span>     <span class="comment"># CKV_AWS_54</span>
      <span class="hl">IgnorePublicAcls</span>: <span class="str">true</span>      <span class="comment"># CKV_AWS_56</span>
      <span class="hl">RestrictPublicBuckets</span>: <span class="str">true</span> <span class="comment"># CKV_AWS_57</span>
    <span class="hl2">VersioningConfiguration</span>:
      <span class="hl">Status</span>: <span class="str">Enabled</span>             <span class="comment"># CKV_AWS_21</span>
    <span class="hl2">LoggingConfiguration</span>:
      <span class="hl">DestinationBucketName</span>: <span class="str">!Ref LoggingBucket</span>  <span class="comment"># CKV_AWS_18</span></pre>
    </div>
    <div class="callout tip"><div class="callout-title">‚úì Comment Your Security Choices</div>Commenting each property with its corresponding Checkov check ID (e.g., <code>CKV_AWS_53</code>) is a professional practice. It documents intent, links to the rule being satisfied, and makes code reviews faster. Junior engineers can look up the rule to understand why the property exists.</div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">A CloudFormation template has a Security Group with the following inbound rule: <code>CidrIp: 0.0.0.0/0, FromPort: 22, ToPort: 22</code>. Why does Checkov flag this as a critical finding?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,1)"><span class="opt-key">A</span>Port 22 is reserved for HTTPS ‚Äî using it for SSH violates AWS naming conventions</button>
        <button class="kcheck-opt" onclick="check(this,false,1)"><span class="opt-key">B</span>CloudFormation doesn't support Security Group rules ‚Äî they must be configured in the console</button>
        <button class="kcheck-opt" onclick="check(this,true,1)"><span class="opt-key">C</span>This exposes SSH to the entire internet (0.0.0.0/0 = all IPs) ‚Äî any machine globally can attempt brute-force login to your EC2 instances</button>
        <button class="kcheck-opt" onclick="check(this,false,1)"><span class="opt-key">D</span>Checkov flags port 22 because it's deprecated ‚Äî all new infrastructure must use port 2222</button>
      </div>
      <div class="kcheck-feedback" id="fb-1"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn" onclick="next()">Next Lesson ‚Üí</button></div>
  </div>

  <!-- LESSON 3 -->
  <div class="lesson-pane" id="pane-2">
    <div class="lesson-tag tag-concept">Tool Deep Dive</div>
    <h1>Checkov:<br><em>Static Analysis</em></h1>
    <p><strong>Objective:</strong> Understand how Checkov works, what it checks, and how to interpret and act on its output.</p>
    <p><strong>Checkov</strong> is an open-source static analysis tool for IaC. It supports CloudFormation, Terraform, Kubernetes manifests, ARM templates, and Dockerfiles. It ships with 1,000+ built-in checks mapped to CIS, NIST, PCI DSS, HIPAA, and SOC2 controls.</p>
    <div class="callout insight"><div class="callout-title">üí° How Checkov Works</div>Checkov parses your IaC files into an abstract syntax tree (AST), then evaluates each resource against a library of checks. Each check is a Python class with a <code>check</code> method that returns PASSED, FAILED, or UNKNOWN. No AWS account access required ‚Äî everything happens locally against the file.</div>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">bash ‚Äî Installation &amp; First Scan</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre><span class="comment"># Install Checkov</span>
pip install checkov

<span class="comment"># Scan a single CloudFormation file</span>
checkov -f template.yaml --framework cloudformation

<span class="comment"># Scan entire directory (catches all templates)</span>
checkov -d ./infrastructure --framework cloudformation

<span class="comment"># Output as JUnit XML for CI/CD integration</span>
checkov -d ./infrastructure --output junitxml > results.xml

<span class="comment"># Only show FAILED checks (cleaner output)</span>
checkov -d ./infrastructure --compact</pre>
    </div>
    <p>A Checkov finding looks like this ‚Äî every field matters:</p>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">Checkov Output</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre><span class="hl2">Check: CKV_AWS_18</span>: <span class="str">"Ensure the S3 bucket has access logging enabled"</span>
<span class="hl">FAILED</span> for resource: <span class="hl2">AWS::S3::Bucket.DataBucket</span>
File: <span class="str">/templates/storage.yaml:14-28</span>
Guide: <span class="str">https://docs.bridgecrew.io/docs/s3_13-enable-logging</span>

  14 | <span class="key">DataBucket</span>:
  15 |   Type: <span class="str">AWS::S3::Bucket</span>
  16 |   Properties:
  17 |     BucketName: <span class="str">my-data-bucket</span>
  <span class="hl">‚Üí Missing: LoggingConfiguration</span></pre>
    </div>
    <p>The output tells you: which check failed (<code>CKV_AWS_18</code>), which resource and file, the exact line number, and a link to the remediation guide. Fix: add the <code>LoggingConfiguration</code> property shown in Lesson 2.</p>
    <div class="callout warning"><div class="callout-title">‚ö† Suppressing False Positives</div>Not every Checkov failure is a real risk in your context. You can suppress a check with a comment: <code># checkov:skip=CKV_AWS_18:Internal bucket, logging not required</code>. Always provide a justification. Suppression without justification is a red flag in security audits.</div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">Checkov reports 3 FAILED checks against your CloudFormation template, but one of them ‚Äî S3 access logging ‚Äî doesn't apply because this bucket is a CloudTrail log destination (logging a logging bucket creates a loop). What should you do?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,2)"><span class="opt-key">A</span>Delete the CloudTrail bucket from the template so Checkov doesn't flag it</button>
        <button class="kcheck-opt" onclick="check(this,false,2)"><span class="opt-key">B</span>Ignore all 3 failures ‚Äî if one is a false positive, the others probably are too</button>
        <button class="kcheck-opt" onclick="check(this,true,2)"><span class="opt-key">C</span>Fix the 2 legitimate findings and add a Checkov skip comment with justification on the logging check</button>
        <button class="kcheck-opt" onclick="check(this,false,2)"><span class="opt-key">D</span>Disable Checkov for all S3 resources to prevent future false positives on this resource type</button>
      </div>
      <div class="kcheck-feedback" id="fb-2"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn" onclick="next()">Next Lesson ‚Üí</button></div>
  </div>

  <!-- LESSON 4 -->
  <div class="lesson-pane" id="pane-3">
    <div class="lesson-tag tag-ops">Operations</div>
    <h1>CI/CD<br><em>Security Gates</em></h1>
    <p><strong>Objective:</strong> Integrate Checkov into a deployment pipeline so security checks run automatically on every code change ‚Äî making safe deployments the path of least resistance.</p>
    <p>A security gate is a pipeline step that <strong>blocks deployment</strong> if security checks fail. Without gates, developers can bypass the scanner by simply deploying directly. With gates, the only way to deploy is through the security check.</p>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">YAML ‚Äî GitHub Actions Security Gate</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre><span class="key">name</span>: <span class="str">IaC Security Scan</span>
<span class="key">on</span>: [<span class="str">push</span>, <span class="str">pull_request</span>]

<span class="key">jobs</span>:
  <span class="hl">checkov-scan</span>:
    <span class="key">runs-on</span>: <span class="str">ubuntu-latest</span>
    <span class="key">steps</span>:
      - <span class="key">uses</span>: <span class="str">actions/checkout@v3</span>

      - <span class="key">name</span>: <span class="str">Run Checkov IaC Scanner</span>
        <span class="key">uses</span>: <span class="str">bridgecrewio/checkov-action@master</span>
        <span class="key">with</span>:
          <span class="key">directory</span>: <span class="str">infrastructure/</span>
          <span class="key">framework</span>: <span class="str">cloudformation</span>
          <span class="hl2">soft_fail</span>: <span class="str">false</span>    <span class="comment"># BLOCK the pipeline on failure</span>
          <span class="key">output_format</span>: <span class="str">sarif</span>
          <span class="key">output_file_path</span>: <span class="str">results.sarif</span>

      - <span class="key">name</span>: <span class="str">Upload SARIF to Security tab</span>
        <span class="key">uses</span>: <span class="str">github/codeql-action/upload-sarif@v2</span>
        <span class="key">with</span>:
          <span class="key">sarif_file</span>: <span class="str">results.sarif</span></pre>
    </div>
    <p>The key setting is <code>soft_fail: false</code> ‚Äî this makes Checkov return a non-zero exit code on failures, which GitHub Actions treats as a build failure. The PR cannot be merged until the findings are fixed.</p>
    <div class="callout tip"><div class="callout-title">‚úì SARIF Output</div>SARIF (Static Analysis Results Interchange Format) is a standard format that GitHub, GitLab, and other platforms understand natively. With the upload step, your Checkov findings appear directly in the GitHub Security tab under Code scanning alerts ‚Äî giving developers in-context feedback exactly where they work.</div>
    <div class="callout warning"><div class="callout-title">‚ö† Gradual Rollout Strategy</div>Don't enable hard-fail gates on an existing codebase with 200 violations ‚Äî developers will disable the gate immediately. Start with <code>soft_fail: true</code> (report only, don't block), fix the backlog, then flip to <code>soft_fail: false</code> once the baseline is clean. This is the professional rollout approach.</div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">You've added Checkov to your GitHub Actions pipeline with <code>soft_fail: true</code>. A developer pushes a CloudFormation template with a public S3 bucket. What happens?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,3)"><span class="opt-key">A</span>The pipeline fails and the PR is blocked ‚Äî soft_fail still blocks deployment</button>
        <button class="kcheck-opt" onclick="check(this,true,3)"><span class="opt-key">B</span>The pipeline succeeds (green) but Checkov's findings are reported ‚Äî the misconfiguration can still be deployed</button>
        <button class="kcheck-opt" onclick="check(this,false,3)"><span class="opt-key">C</span>The pipeline auto-fixes the S3 misconfiguration before deploying</button>
        <button class="kcheck-opt" onclick="check(this,false,3)"><span class="opt-key">D</span>Checkov emails the security team and waits for manual approval</button>
      </div>
      <div class="kcheck-feedback" id="fb-3"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn lab-btn" onclick="next()">Start Lab ‚Üí</button></div>
  </div>

  <!-- LAB -->
  <div class="lesson-pane lab-pane" id="pane-4">
    <div class="lesson-tag tag-lab">üî¨ Hands-On Lab</div>
    <h1>Checkov +<br><em>CloudFormation</em></h1>
    <p>You'll scan a deliberately insecure CloudFormation template, interpret the findings, apply fixes, re-scan to confirm clean, then write a GitHub Actions pipeline gate.</p>
    <div class="callout lab-note"><div class="callout-title">‚ö° Prerequisites</div>Python 3.7+ installed locally. Run <code>pip install checkov</code> before starting. No AWS account access required for this lab ‚Äî everything runs locally against template files.</div>
    <div class="lab-steps">
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">1</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Create the Insecure Template <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~10 min</span></div>
          <div class="step-body">
            <p style="margin-bottom:10px;color:#8a92a8">Save this deliberately insecure template as <code>insecure.yaml</code> in your labs folder:</p>
            <div class="code-block">
              <div class="code-header"><span class="code-lang">YAML ‚Äî insecure.yaml</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre><span class="comment">AWSTemplateFormatVersion: '2010-09-09'</span>
<span class="key">Resources</span>:
  <span class="hl2">InsecureBucket</span>:
    <span class="hl">Type</span>: <span class="str">AWS::S3::Bucket</span>
    <span class="comment">  # No encryption, no public access block, no versioning</span>

  <span class="hl2">OpenSecurityGroup</span>:
    <span class="hl">Type</span>: <span class="str">AWS::EC2::SecurityGroup</span>
    <span class="hl">Properties</span>:
      <span class="hl">GroupDescription</span>: <span class="str">Open SG</span>
      <span class="hl">SecurityGroupIngress</span>:
        - <span class="hl">IpProtocol</span>: <span class="str">tcp</span>
          <span class="hl">FromPort</span>: <span class="str">22</span>
          <span class="hl">ToPort</span>: <span class="str">22</span>
          <span class="hl2">CidrIp</span>: <span class="str">0.0.0.0/0</span>   <span class="comment"># World-open SSH</span></pre>
            </div>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">2</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Run Initial Checkov Scan <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~5 min</span></div>
          <div class="step-body">
            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre>checkov -f insecure.yaml --framework cloudformation --compact</pre>
            </div>
            <p style="color:#8a92a8;margin-top:8px">You should see multiple FAILED checks. <strong>Record them</strong> ‚Äî screenshot for your portfolio. Count the failures; you'll verify the number drops to zero after fixing.</p>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">3</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Fix the Template <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~20 min</span></div>
          <div class="step-body">
            <p style="margin-bottom:10px;color:#8a92a8">Save this as <code>secure.yaml</code>. Every fix maps to a Checkov check ID:</p>
            <div class="code-block">
              <div class="code-header"><span class="code-lang">YAML ‚Äî secure.yaml</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre><span class="comment">AWSTemplateFormatVersion: '2010-09-09'</span>
<span class="key">Resources</span>:
  <span class="hl2">SecureBucket</span>:
    <span class="hl">Type</span>: <span class="str">AWS::S3::Bucket</span>
    <span class="hl">Properties</span>:
      <span class="hl">BucketEncryption</span>:
        <span class="hl">ServerSideEncryptionConfiguration</span>:
          - <span class="hl">ServerSideEncryptionByDefault</span>:
              <span class="hl">SSEAlgorithm</span>: <span class="str">AES256</span>
      <span class="hl">PublicAccessBlockConfiguration</span>:
        <span class="hl">BlockPublicAcls</span>: <span class="str">true</span>
        <span class="hl">BlockPublicPolicy</span>: <span class="str">true</span>
        <span class="hl">IgnorePublicAcls</span>: <span class="str">true</span>
        <span class="hl">RestrictPublicBuckets</span>: <span class="str">true</span>
      <span class="hl">VersioningConfiguration</span>:
        <span class="hl">Status</span>: <span class="str">Enabled</span>
      <span class="hl">LoggingConfiguration</span>:
        <span class="hl">DestinationBucketName</span>: <span class="str">my-log-bucket</span>
        <span class="comment"># checkov:skip=CKV_AWS_18:Log bucket - circular logging prevented by design</span>

  <span class="hl2">RestrictedSecurityGroup</span>:
    <span class="hl">Type</span>: <span class="str">AWS::EC2::SecurityGroup</span>
    <span class="hl">Properties</span>:
      <span class="hl">GroupDescription</span>: <span class="str">Restricted SG - no public SSH</span>
      <span class="hl">SecurityGroupIngress</span>: []  <span class="comment"># No inbound rules - use Session Manager</span></pre>
            </div>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">4</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Verify Clean Scan <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~5 min</span></div>
          <div class="step-body">
            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre>checkov -f secure.yaml --framework cloudformation --compact
<span class="comment"># Target: 0 FAILED checks (only PASSed + SKIPped)</span></pre>
            </div>
            <p style="color:#8a92a8;margin-top:8px">Screenshot the clean output. Before/after screenshots = your portfolio deliverable for today.</p>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">5</div></div>
        <div class="step-content">
          <div class="step-title">GitHub Commit <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~5 min</span></div>
          <div class="step-body">
            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre>git add week-2/labs/insecure.yaml week-2/labs/secure.yaml
git add screenshots/day-11-*.png
git commit -m "Day 11: IaC scanning ‚Äî Checkov findings resolved, 0 failures on secure template"
git push</pre>
            </div>
          </div>
        </div>
      </div>
    </div>
    <h2 style="font-family:'DM Serif Display',serif;font-size:20px;color:#e4eaf6;margin:32px 0 16px;font-weight:400">Lab Checklist</h2>
    <div class="checklist-progress"><div class="checklist-progress-bar"><div class="checklist-progress-fill" id="cl-fill"></div></div><span class="checklist-progress-label" id="cl-label">0 / 6</span></div>
    <div class="checklist">
      <div class="check-item" onclick="toggleCheck(this,0)"><div class="check-box">‚úì</div><div class="check-text">Checkov installed and running (<code>checkov --version</code> succeeds)</div></div>
      <div class="check-item" onclick="toggleCheck(this,1)"><div class="check-box">‚úì</div><div class="check-text">insecure.yaml scanned ‚Äî screenshot of FAILED findings taken</div></div>
      <div class="check-item" onclick="toggleCheck(this,2)"><div class="check-box">‚úì</div><div class="check-text">Each failing check identified and mapped to its fix</div></div>
      <div class="check-item" onclick="toggleCheck(this,3)"><div class="check-box">‚úì</div><div class="check-text">secure.yaml created ‚Äî 0 FAILED checks on re-scan</div></div>
      <div class="check-item" onclick="toggleCheck(this,4)"><div class="check-box">‚úì</div><div class="check-text">Skip comment added with justification for the log-bucket exception</div></div>
      <div class="check-item" onclick="toggleCheck(this,5)"><div class="check-box">‚úì</div><div class="check-text">GitHub commit pushed with both templates + before/after screenshots</div></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn lab-btn" onclick="finish()">Complete Day 11 ‚úì</button></div>
  </div>

  <!-- COMPLETION -->
  <div class="lesson-pane" id="pane-complete">
    <div class="completion-card">
      <span class="completion-icon">üîç</span>
      <h1>Day 11 Complete</h1>
      <p>You can now find security misconfigurations in infrastructure code before they're ever deployed ‚Äî one of the highest-leverage skills in cloud security engineering.</p>
      <div class="score-pill"><span>‚ö°</span> Quiz: <span id="score-val">‚Äî</span></div><br>
      <div class="lab-score-pill"><span>üî¨</span> Lab: <span id="lab-score-val">‚Äî</span> complete</div>
      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
        <a href="../index.html" style="text-decoration:none"><button class="prev-btn">‚Üê Course Index</button></a>
        <a href="day-12.html" style="text-decoration:none"><button class="next-btn">Day 12 ‚Üí</button></a>
      </div>
    </div>
  </div>
</div>
</div>
<script src="csm-core.js"></script>
<script>
initPage({
  storageKey: 'csm-day11',
  total: 5,
  quizCount: 4,
  checkTotal: 6,
  titles: ['Shift-Left Security','CloudFormation Security Patterns','Checkov: Static Analysis','CI/CD Security Gates','Hands-on: Checkov + CloudFormation'],
  fb: {
  0:{good:"Correct. In a CI/CD pipeline, Checkov scans the CloudFormation template before any deployment runs. Catching it here means a 30-second fix in a text editor ‚Äî compared to re-deploying, re-auditing, or worse, discovering it after a data exposure incident.",bad:"Not quite. Config and Security Hub are post-deployment detective controls ‚Äî they catch misconfigurations after the bucket exists in production. The cheapest fix is before deployment, in the IaC file itself."},
  1:{good:"Correct. CIDR 0.0.0.0/0 means every IP address on the internet. Any machine globally can attempt an SSH connection to your EC2 instances on port 22 ‚Äî making brute-force attacks, credential stuffing, and exploitation of SSH vulnerabilities trivially easy.",bad:"Not quite. Port 22 is the standard SSH port. The problem is the CIDR: 0.0.0.0/0 means the entire internet can reach it. Even if you have a strong password, exposing SSH to the world is a serious misconfiguration that's trivially exploited."},
  2:{good:"Correct. This is exactly how professional IaC security works: fix genuine findings, document exceptions with justification. The skip comment becomes part of the audit trail ‚Äî anyone reading the code later can see why the check was bypassed, rather than wondering if it was an oversight.",bad:"Not quite. Skipping the entire check type or ignoring all findings because one is a false positive is an anti-pattern that removes real protection. The correct approach is surgical: fix what's real, document what's intentional."},
  3:{good:"Correct. soft_fail: true makes Checkov informational ‚Äî it reports findings but always exits with code 0, so the pipeline succeeds. The developer can still merge and deploy the misconfigured template. This mode is useful for introducing scanning without immediately breaking workflows, but it's not a security gate.",bad:"Not quite. soft_fail: true specifically means Checkov will not block the pipeline. It reports findings but exits cleanly ‚Äî the PR can still be merged. Only soft_fail: false (or no soft_fail setting) actually gates deployment on scan results."}
}
});
</script>
</body>
</html>
