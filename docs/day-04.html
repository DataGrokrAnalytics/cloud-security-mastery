<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Day 4 ‚Äî Policy-as-Code: AWS Organizations & SCPs</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root{--bg:#0d0f14;--surface:#13161d;--surface2:#181c26;--border:#1f2330;--border-hi:#2e3447;--text:#c8d0e0;--muted:#5a6178;--faint:#3a3f52;--accent:#4af0c4;--accent-dim:rgba(74,240,196,.08);--amber:#f0924a;--violet:#8a7fff;--danger:#f05a5a;--code-bg:#0a0c10;--pill:#1a1f2e;--lab:#f0c84a;--lab-dim:rgba(240,200,74,.08);}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--text);font-family:'DM Sans',sans-serif;font-weight:300;font-size:15px;line-height:1.75;min-height:100vh;overflow-x:hidden}
.shell{display:grid;grid-template-columns:268px 1fr;min-height:100vh}
.sidebar{background:var(--surface);border-right:1px solid var(--border);padding:32px 0;position:sticky;top:0;height:100vh;overflow-y:auto;display:flex;flex-direction:column}
.sidebar-header{padding:0 24px 24px;border-bottom:1px solid var(--border)}
.day-badge{font-family:'IBM Plex Mono',monospace;font-size:10px;letter-spacing:.12em;text-transform:uppercase;color:var(--accent);margin-bottom:6px}
.sidebar-header h2{font-family:'DM Serif Display',serif;font-size:15px;font-weight:400;color:#e4eaf6;line-height:1.4}
.sidebar-meta{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.chip{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.06em;background:var(--pill);color:var(--muted);padding:3px 8px;border-radius:3px}
.lesson-nav{padding:16px 0;flex:1}
.nav-group-label{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.14em;text-transform:uppercase;color:var(--faint);padding:10px 24px 6px}
.nav-item{display:flex;align-items:center;gap:10px;padding:9px 24px;cursor:pointer;transition:background .15s;border-left:2px solid transparent}
.nav-item:hover{background:rgba(255,255,255,.03)}
.nav-item.active{background:var(--accent-dim);border-left-color:var(--accent)}.nav-item.active .nav-label{color:var(--accent)}
.nav-item.lab-item.active{background:var(--lab-dim);border-left-color:var(--lab)}.nav-item.lab-item.active .nav-label{color:var(--lab)}
.nav-num{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);width:18px;flex-shrink:0;text-align:right}
.nav-label{font-size:12.5px;color:#8a92a8;line-height:1.3}
.nav-check{margin-left:auto;width:14px;height:14px;border-radius:50%;border:1px solid var(--border-hi);flex-shrink:0;display:flex;align-items:center;justify-content:center;font-size:8px;color:transparent;transition:all .2s}
.nav-item.done .nav-check{background:var(--accent);border-color:var(--accent);color:var(--bg)}
.nav-item.lab-item.done .nav-check{background:var(--lab);border-color:var(--lab);color:var(--bg)}
.sidebar-footer{padding:20px 24px;border-top:1px solid var(--border);margin-top:auto}
.progress-label{display:flex;justify-content:space-between;font-size:11px;color:var(--muted);margin-bottom:8px}
.progress-bar{height:3px;background:var(--border);border-radius:2px;overflow:hidden}
.progress-fill{height:100%;background:var(--accent);border-radius:2px;transition:width .4s ease;width:0%}

/* ‚îÄ‚îÄ Sidebar back navigation ‚îÄ‚îÄ */
.sidebar-back{padding:14px 24px 12px;border-bottom:1px solid var(--border);display:flex;flex-direction:column;gap:6px}
.back-index{display:flex;align-items:center;gap:8px;font-family:'IBM Plex Mono',monospace;font-size:10px;letter-spacing:.06em;color:var(--muted);text-decoration:none;padding:6px 10px;border-radius:5px;border:1px solid var(--border-hi);transition:all .15s;background:transparent}
.back-index:hover{color:var(--accent);border-color:var(--accent);background:var(--accent-dim)}
.back-index svg{flex-shrink:0;opacity:.6}
.week-jumps{display:flex;gap:5px;flex-wrap:wrap;margin-top:2px}
.week-jump{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.06em;padding:3px 9px;border-radius:3px;border:1px solid var(--border-hi);color:var(--muted);text-decoration:none;transition:all .12s;background:transparent;cursor:pointer}
.week-jump:hover{color:var(--text);border-color:var(--border-hi);background:rgba(255,255,255,.04)}
.week-jump.wj1{color:#4af0c4;border-color:rgba(74,240,196,.3)}
.week-jump.wj2{color:#8a7fff;border-color:rgba(138,127,255,.3)}
.week-jump.wj3{color:#f0924a;border-color:rgba(240,146,74,.3)}
.week-jump.wj4{color:#f05a5a;border-color:rgba(240,90,90,.3)}
.week-jumps-label{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.1em;text-transform:uppercase;color:var(--faint);margin-bottom:1px}

/* ‚îÄ‚îÄ Day nav strip ‚îÄ‚îÄ */
.day-nav-label{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.1em;text-transform:uppercase;color:var(--faint);margin-top:8px;margin-bottom:2px}
.day-nav{display:flex;gap:4px;flex-wrap:wrap}
.day-link{font-family:'IBM Plex Mono',monospace;font-size:9px;padding:3px 7px;border-radius:3px;border:1px solid var(--border-hi);color:var(--muted);text-decoration:none;transition:all .12s;background:transparent}
.day-link:hover{color:var(--text);background:rgba(255,255,255,.04)}
.day-link.current{color:var(--accent);border-color:rgba(74,240,196,.4);background:rgba(74,240,196,.06);font-weight:600}

.main{display:flex;flex-direction:column}
.lesson-topbar{display:flex;align-items:center;justify-content:space-between;padding:16px 48px;border-bottom:1px solid var(--border);background:var(--surface);position:sticky;top:0;z-index:10}
.lesson-crumb{font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--muted)}.lesson-crumb span{color:var(--text)}
.nav-arrows{display:flex;gap:8px}
.arrow-btn{background:var(--pill);border:1px solid var(--border-hi);color:var(--muted);border-radius:5px;padding:5px 12px;font-size:12px;cursor:pointer;font-family:'IBM Plex Mono',monospace;transition:all .15s}
.arrow-btn:hover:not(:disabled){border-color:var(--accent);color:var(--accent)}.arrow-btn:disabled{opacity:.3;cursor:default}
.lesson-pane{display:none;flex-direction:column;padding:56px 48px 80px;max-width:760px;animation:fadeIn .3s ease}
.lesson-pane.active{display:flex}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
.lesson-tag{font-family:'IBM Plex Mono',monospace;font-size:10px;letter-spacing:.12em;text-transform:uppercase;margin-bottom:14px}
.tag-concept{color:var(--violet)}.tag-warning{color:var(--amber)}.tag-security{color:var(--accent)}.tag-ops{color:#f0c84a}.tag-lab{color:var(--lab)}.tag-arch{color:#f0924a}
.lesson-pane h1{font-family:'DM Serif Display',serif;font-size:28px;font-weight:400;line-height:1.25;color:#e8eef8;margin-bottom:24px}
.lesson-pane h1 em{font-style:italic;color:var(--accent)}.lab-pane h1 em{color:var(--lab)}
.lesson-pane p{color:var(--text);margin-bottom:18px;font-size:15px}
.lesson-pane strong{color:#e0e6f0;font-weight:500}
.callout{border-left:3px solid;padding:16px 20px;border-radius:0 6px 6px 0;margin:24px 0;font-size:14px;line-height:1.7}
.callout-title{font-family:'IBM Plex Mono',monospace;font-size:10px;letter-spacing:.1em;text-transform:uppercase;margin-bottom:8px;font-weight:600}
.callout.breach{border-color:var(--danger);background:rgba(240,90,90,.06)}.callout.breach .callout-title{color:var(--danger)}
.callout.insight{border-color:var(--violet);background:rgba(138,127,255,.06)}.callout.insight .callout-title{color:var(--violet)}
.callout.tip{border-color:var(--accent);background:var(--accent-dim)}.callout.tip .callout-title{color:var(--accent)}
.callout.warning{border-color:var(--amber);background:rgba(240,146,74,.06)}.callout.warning .callout-title{color:var(--amber)}
.callout.lab-note{border-color:var(--lab);background:var(--lab-dim)}.callout.lab-note .callout-title{color:var(--lab)}
.arch-diagram{background:var(--code-bg);border:1px solid var(--border);border-radius:8px;padding:28px;margin:24px 0;font-family:'IBM Plex Mono',monospace;font-size:12.5px;line-height:2.1;color:#6a7490}
.arch-diagram .node-root{color:var(--danger)}.arch-diagram .node-ou{color:var(--amber)}.arch-diagram .node-acct{color:var(--accent)}.arch-diagram .node-scp{color:var(--violet)}.arch-diagram .node-arrow{color:var(--border-hi)}.arch-diagram .node-label{color:#5a6178;font-size:11px}
.styled-table{width:100%;border-collapse:collapse;margin:24px 0;font-size:13.5px}
.styled-table th{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.1em;text-transform:uppercase;color:var(--muted);text-align:left;padding:10px 16px;border-bottom:1px solid var(--border);background:var(--surface)}
.styled-table td{padding:11px 16px;border-bottom:1px solid var(--border);color:var(--text);vertical-align:top}
.styled-table tr:hover td{background:rgba(255,255,255,.02)}
.styled-table td:first-child{font-family:'IBM Plex Mono',monospace;font-size:11.5px;color:var(--violet)}
.eval-flow{display:flex;flex-direction:column;gap:0;margin:24px 0;border:1px solid var(--border);border-radius:8px;overflow:hidden}
.eval-step{display:flex;align-items:center;gap:16px;padding:14px 20px;border-bottom:1px solid var(--border)}
.eval-step:last-child{border-bottom:none}
.eval-num{font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--muted);width:22px;flex-shrink:0}
.eval-q{font-size:13.5px;color:#8a92a8;flex:1}
.eval-result{font-family:'IBM Plex Mono',monospace;font-size:11px;padding:3px 10px;border-radius:3px;white-space:nowrap}
.eval-result.deny{background:rgba(240,90,90,.15);color:var(--danger)}
.eval-result.allow{background:rgba(74,240,196,.1);color:var(--accent)}
.eval-result.next{background:rgba(138,127,255,.1);color:var(--violet)}
.code-block{background:var(--code-bg);border:1px solid var(--border);border-radius:6px;margin:20px 0;overflow:hidden}
.code-header{display:flex;align-items:center;justify-content:space-between;padding:8px 16px;border-bottom:1px solid var(--border);background:rgba(255,255,255,.02)}
.code-lang{font-family:'IBM Plex Mono',monospace;font-size:10px;letter-spacing:.06em;color:var(--muted);text-transform:uppercase}
.copy-btn{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);background:transparent;border:1px solid var(--border-hi);border-radius:3px;padding:2px 8px;cursor:pointer;transition:all .15s}
.copy-btn:hover{color:var(--accent);border-color:var(--accent)}
.code-block pre{font-family:'IBM Plex Mono',monospace;font-size:12.5px;line-height:1.8;padding:16px 20px;color:#a8b4cc;overflow-x:auto}
.code-block pre .hl{color:var(--accent)}.code-block pre .hl2{color:var(--amber)}.code-block pre .comment{color:var(--muted)}
.kcheck{background:var(--surface);border:1px solid var(--border);border-radius:10px;padding:28px 28px 24px;margin:36px 0 24px}
.kcheck-label{font-family:'IBM Plex Mono',monospace;font-size:9px;letter-spacing:.14em;text-transform:uppercase;color:var(--violet);margin-bottom:14px}
.kcheck-q{font-size:15px;color:#d0d8ec;font-weight:500;margin-bottom:20px;line-height:1.5}
.kcheck-options{display:flex;flex-direction:column;gap:10px}
.kcheck-opt{display:flex;align-items:flex-start;gap:12px;padding:12px 16px;border:1px solid var(--border-hi);border-radius:7px;cursor:pointer;transition:all .15s;font-size:13.5px;color:#8a92a8;background:transparent;width:100%;text-align:left}
.kcheck-opt:hover:not(.disabled){border-color:var(--violet);background:rgba(138,127,255,.05);color:var(--text)}
.kcheck-opt.correct{border-color:var(--accent);background:rgba(74,240,196,.07);color:var(--accent)}
.kcheck-opt.wrong{border-color:var(--danger);background:rgba(240,90,90,.07);color:var(--danger)}
.kcheck-opt.reveal-correct{border-color:var(--accent);background:rgba(74,240,196,.04);color:#6e9e90}
.opt-key{font-family:'IBM Plex Mono',monospace;font-size:11px;width:22px;height:22px;border-radius:4px;background:var(--border);display:flex;align-items:center;justify-content:center;flex-shrink:0;color:var(--muted);transition:all .15s;margin-top:1px}
.kcheck-opt.correct .opt-key{background:var(--accent);color:var(--bg)}.kcheck-opt.wrong .opt-key{background:var(--danger);color:#fff}.kcheck-opt.reveal-correct .opt-key{background:rgba(74,240,196,.2);color:var(--accent)}
.kcheck-feedback{margin-top:18px;padding:14px 16px;border-radius:7px;font-size:13.5px;line-height:1.65;display:none}
.kcheck-feedback.show{display:block}.kcheck-feedback.good{background:rgba(74,240,196,.08);border:1px solid rgba(74,240,196,.2);color:#7eceb8}.kcheck-feedback.bad{background:rgba(240,90,90,.08);border:1px solid rgba(240,90,90,.2);color:#c47a7a}
.lab-steps{display:flex;flex-direction:column;gap:0;margin:24px 0}
.lab-step{display:flex;gap:20px;padding:20px 0;border-bottom:1px solid var(--border)}.lab-step:last-child{border-bottom:none}
.step-num-wrap{display:flex;flex-direction:column;align-items:center;flex-shrink:0}
.step-num{width:32px;height:32px;border-radius:50%;background:var(--pill);border:2px solid var(--border-hi);font-family:'IBM Plex Mono',monospace;font-size:12px;color:var(--muted);display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all .3s;position:relative;z-index:1}
.step-connector{width:2px;flex:1;background:var(--border);margin-top:4px}.lab-step:last-child .step-connector{display:none}
.step-content{flex:1;padding-top:4px}
.step-title{font-family:'DM Serif Display',serif;font-size:16px;color:#e4eaf6;margin-bottom:8px}
.step-body{font-size:14px;color:var(--text);line-height:1.7}
.step-body ol{padding-left:20px;display:flex;flex-direction:column;gap:6px;margin:10px 0}.step-body li{color:#a0a8bc}
.step-body code{font-family:'IBM Plex Mono',monospace;font-size:12px;background:var(--pill);padding:1px 6px;border-radius:3px;color:var(--violet)}
.checklist{display:flex;flex-direction:column;gap:10px;margin:24px 0}
.check-item{display:flex;align-items:flex-start;gap:12px;padding:12px 16px;background:var(--surface);border:1px solid var(--border);border-radius:7px;cursor:pointer;transition:all .2s;user-select:none}
.check-item:hover{border-color:var(--border-hi)}.check-item.checked{border-color:rgba(240,200,74,.3);background:rgba(240,200,74,.05)}
.check-box{width:18px;height:18px;border-radius:4px;border:2px solid var(--border-hi);flex-shrink:0;display:flex;align-items:center;justify-content:center;transition:all .2s;margin-top:1px;font-size:10px;color:transparent}
.check-item.checked .check-box{background:var(--lab);border-color:var(--lab);color:var(--bg)}
.check-text{font-size:13.5px;color:#8a92a8;line-height:1.5}.check-item.checked .check-text{color:var(--muted);text-decoration:line-through;text-decoration-color:var(--faint)}
.checklist-progress{display:flex;align-items:center;gap:12px;margin-bottom:16px}
.checklist-progress-bar{flex:1;height:3px;background:var(--border);border-radius:2px;overflow:hidden}
.checklist-progress-fill{height:100%;background:var(--lab);border-radius:2px;transition:width .4s ease}
.checklist-progress-label{font-family:'IBM Plex Mono',monospace;font-size:10px;color:var(--muted);white-space:nowrap}
.lesson-nav-footer{display:flex;justify-content:space-between;align-items:center;margin-top:52px;padding-top:28px;border-top:1px solid var(--border)}
.next-btn{background:var(--accent);color:var(--bg);border:none;border-radius:6px;padding:11px 24px;font-family:'IBM Plex Mono',monospace;font-size:12px;font-weight:600;cursor:pointer;letter-spacing:.04em;transition:opacity .15s;display:flex;align-items:center;gap:8px;text-decoration:none}
.next-btn:hover{opacity:.88}.next-btn.lab-btn{background:var(--lab)}
.prev-btn{background:transparent;color:var(--muted);border:1px solid var(--border-hi);border-radius:6px;padding:11px 20px;font-family:'IBM Plex Mono',monospace;font-size:12px;cursor:pointer;letter-spacing:.04em;transition:all .15s;text-decoration:none;display:inline-flex;align-items:center}
.prev-btn:hover{color:var(--text);border-color:var(--text)}.prev-btn:disabled{opacity:.3;cursor:default}
.completion-card{text-align:center;padding:56px 32px}
.completion-icon{font-size:48px;margin-bottom:20px;display:block}
.completion-card h1{font-family:'DM Serif Display',serif;font-size:32px;color:var(--accent);margin-bottom:12px}
.completion-card p{color:var(--muted);max-width:420px;margin:0 auto 28px;font-size:14px}
.score-pill{display:inline-flex;align-items:center;gap:8px;background:rgba(74,240,196,.1);border:1px solid rgba(74,240,196,.25);color:var(--accent);border-radius:40px;padding:8px 20px;font-family:'IBM Plex Mono',monospace;font-size:13px;margin-bottom:8px}
.lab-score-pill{display:inline-flex;align-items:center;gap:8px;background:rgba(240,200,74,.1);border:1px solid rgba(240,200,74,.25);color:var(--lab);border-radius:40px;padding:8px 20px;font-family:'IBM Plex Mono',monospace;font-size:13px;margin-bottom:32px}
::-webkit-scrollbar{width:5px;height:5px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:var(--border-hi);border-radius:3px}
@media(max-width:768px){.shell{grid-template-columns:1fr}.sidebar{display:none}.lesson-pane{padding:32px 24px 60px}.lesson-topbar{padding:14px 24px}}
</style>
</head>
<body>
<div class="shell">
<nav class="sidebar">
  <div class="sidebar-header">
    <div class="day-badge">Week 1 ¬∑ Day 4</div>
    <h2>Policy-as-Code:<br>Organizations &amp; SCPs</h2>
    <div class="sidebar-meta"><span class="chip">Beginner</span><span class="chip">4 lessons</span><span class="chip">1 lab</span><span class="chip">~4h</span></div>
  </div>
  <div class="sidebar-back">
    <a class="back-index" href="../index.html">
      <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M7.5 2L3.5 6L7.5 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Course Index
    </a>
    <div class="week-jumps-label">Jump to week</div>
    <div class="week-jumps">
      <a class="week-jump wj1" href="../index.html#week-1" onclick="sessionStorage.setItem('openWeek','1')">W1</a>
      <a class="week-jump" href="../index.html#week-2" onclick="sessionStorage.setItem('openWeek','2')">W2</a>
      <a class="week-jump" href="../index.html#week-3" onclick="sessionStorage.setItem('openWeek','3')">W3</a>
      <a class="week-jump" href="../index.html#week-4" onclick="sessionStorage.setItem('openWeek','4')">W4</a>
    </div>
    <div class="day-nav-label">Week 1 days</div>
    <div class="day-nav">
      <a class="day-link" href="day-01.html">D1</a>
      <a class="day-link" href="day-02.html">D2</a>
      <a class="day-link" href="day-03.html">D3</a>
      <a class="day-link current" href="day-04.html">D4</a>
      <a class="day-link" href="day-05.html">D5</a>
      <a class="day-link" href="day-06.html">D6</a>
      <a class="day-link" href="day-07.html">D7</a>
    </div>
  </div>
  <div class="lesson-nav">
    <div class="nav-group-label">Lessons</div>
    <div class="nav-item active" onclick="goTo(0)"><span class="nav-num">01</span><span class="nav-label">AWS Organizations Overview</span><span class="nav-check">‚úì</span></div>
    <div class="nav-item" onclick="goTo(1)"><span class="nav-num">02</span><span class="nav-label">SCPs vs. IAM Policies</span><span class="nav-check">‚úì</span></div>
    <div class="nav-item" onclick="goTo(2)"><span class="nav-num">03</span><span class="nav-label">SCP Evaluation Logic</span><span class="nav-check">‚úì</span></div>
    <div class="nav-item" onclick="goTo(3)"><span class="nav-num">04</span><span class="nav-label">Common SCP Patterns</span><span class="nav-check">‚úì</span></div>
    <div class="nav-group-label" style="margin-top:8px">Lab</div>
    <div class="nav-item lab-item" onclick="goTo(4)"><span class="nav-num" style="color:var(--lab)">üî¨</span><span class="nav-label">Hands-on: Deploy an SCP</span><span class="nav-check">‚úì</span></div>
  </div>
  <div class="sidebar-footer">
    <div class="progress-label"><span>Progress</span><span id="progress-pct">0 / 5</span></div>
    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
  </div>
</nav>
<div class="main">
  <div class="lesson-topbar">
    <div class="lesson-crumb">Day 4 &nbsp;/&nbsp; <span id="topbar-title">AWS Organizations Overview</span></div>
    <div class="nav-arrows">
      <button class="arrow-btn" id="btn-prev" onclick="prev()" disabled>‚Üê Prev</button>
      <button class="arrow-btn" id="btn-next" onclick="next()">Next ‚Üí</button>
    </div>
  </div>

  <!-- LESSON 1 -->
  <div class="lesson-pane active" id="pane-0">
    <div class="lesson-tag tag-arch">Architecture</div>
    <h1>AWS Organizations<br><em>Overview</em></h1>
    <p><strong>Objective:</strong> Understand what AWS Organizations is, why enterprises use it, and the three-level hierarchy you'll work with.</p>
    <p>Most real-world AWS environments aren't a single account ‚Äî they're dozens or hundreds of accounts organised around workloads, environments, and teams. AWS Organizations is the management service that structures these accounts and applies security policies across all of them.</p>
    <div class="arch-diagram">
<span class="node-root">Management Account (Root)</span>  <span class="node-label">‚Üê master payer, policy authority</span>
<span class="node-arrow">    ‚îÇ</span>
<span class="node-arrow">    ‚îú‚îÄ‚îÄ</span> <span class="node-ou">OU: Production</span>
<span class="node-arrow">    ‚îÇ       ‚îú‚îÄ‚îÄ</span> <span class="node-acct">Account: prod-workload-a</span>
<span class="node-arrow">    ‚îÇ       ‚îî‚îÄ‚îÄ</span> <span class="node-acct">Account: prod-workload-b</span>
<span class="node-arrow">    ‚îÇ</span>
<span class="node-arrow">    ‚îú‚îÄ‚îÄ</span> <span class="node-ou">OU: Development</span>
<span class="node-arrow">    ‚îÇ       ‚îî‚îÄ‚îÄ</span> <span class="node-acct">Account: dev-sandbox</span>
<span class="node-arrow">    ‚îÇ</span>
<span class="node-arrow">    ‚îî‚îÄ‚îÄ</span> <span class="node-ou">OU: Security</span>
<span class="node-arrow">            ‚îî‚îÄ‚îÄ</span> <span class="node-acct">Account: security-tooling</span>  <span class="node-label">‚Üê GuardDuty delegated admin</span>
    </div>
    <p>The hierarchy matters because <strong>policies flow downward</strong>. A Service Control Policy (SCP) attached to the Root applies to every account in every OU. An SCP attached to the Production OU applies only to accounts in that OU. This gives you fine-grained, inheritance-based governance.</p>
    <div class="callout insight"><div class="callout-title">üí° Why Separate Accounts?</div>Account-level isolation is the strongest blast radius limiter in AWS. If an attacker compromises an IAM credential in your dev sandbox, account boundaries prevent them from touching production ‚Äî no amount of clever IAM policies is needed. The separation is architectural.</div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">You attach a security SCP to the Root of your AWS Organization. Which accounts does it affect?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,0)"><span class="opt-key">A</span>Only the Management Account ‚Äî it's the root of the hierarchy</button>
        <button class="kcheck-opt" onclick="check(this,true,0)"><span class="opt-key">B</span>Every account in the entire organisation ‚Äî policies attached to Root inherit downward to all OUs and accounts</button>
        <button class="kcheck-opt" onclick="check(this,false,0)"><span class="opt-key">C</span>Only accounts directly under Root ‚Äî OU member accounts are separate</button>
        <button class="kcheck-opt" onclick="check(this,false,0)"><span class="opt-key">D</span>Only accounts where the SCP has been manually applied</button>
      </div>
      <div class="kcheck-feedback" id="fb-0"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" disabled>‚Üê Previous</button><button class="next-btn" onclick="next()">Next Lesson ‚Üí</button></div>
  </div>

  <!-- LESSON 2 -->
  <div class="lesson-pane" id="pane-1">
    <div class="lesson-tag tag-concept">Core Concept</div>
    <h1>SCPs vs.<br><em>IAM Policies</em></h1>
    <p><strong>Objective:</strong> Understand the critical difference between guardrails (SCPs) and permissions (IAM) ‚Äî and why you need both.</p>
    <p>This is the most common source of confusion in AWS governance. SCPs and IAM policies look similar (both are JSON, both use Allow/Deny) but serve completely different purposes.</p>
    <table class="styled-table">
      <thead><tr><th>Dimension</th><th>SCP (Service Control Policy)</th><th>IAM Policy</th></tr></thead>
      <tbody>
        <tr><td>Purpose</td><td>Sets the maximum permissions ceiling ‚Äî what can ever be done</td><td>Grants specific permissions ‚Äî what this identity can do</td></tr>
        <tr><td>Analogy</td><td>Building code ‚Äî sets what structures are allowed to exist</td><td>Floor plan ‚Äî determines the layout within the allowed structure</td></tr>
        <tr><td>Applied to</td><td>AWS accounts and OUs in Organizations</td><td>IAM users, roles, and groups</td></tr>
        <tr><td>Can grant access?</td><td>‚ùå No ‚Äî SCPs never grant permissions, only restrict them</td><td>‚úÖ Yes ‚Äî IAM policies grant access</td></tr>
        <tr><td>Bypassed by root?</td><td>‚úÖ Applies to all identities including root</td><td>‚ùå Root ignores IAM policies</td></tr>
      </tbody>
    </table>
    <div class="callout tip"><div class="callout-title">‚úì The Key Mental Model</div>Think of SCPs as the outer box. IAM policies define what fits inside that box. Even if an IAM admin grants full S3 access, if an SCP says "deny public buckets," the bucket cannot be made public ‚Äî regardless of who's asking.</div>
    <div class="callout warning"><div class="callout-title">‚ö† SCPs Don't Apply to the Management Account</div>SCPs never restrict the management (root) account itself ‚Äî only member accounts. This is why the management account should be used only for billing and governance, with no workloads running in it.</div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">An SCP in your organisation denies the <code style="font-family:'IBM Plex Mono',monospace;font-size:12px;background:var(--pill);padding:1px 5px;border-radius:3px;color:var(--violet)">s3:PutBucketAcl</code> action. An IAM admin in a member account tries to make an S3 bucket public. What happens?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,1)"><span class="opt-key">A</span>It succeeds ‚Äî the IAM admin has AdministratorAccess which overrides SCPs</button>
        <button class="kcheck-opt" onclick="check(this,false,1)"><span class="opt-key">B</span>It succeeds ‚Äî SCPs only affect root users, not IAM admins</button>
        <button class="kcheck-opt" onclick="check(this,true,1)"><span class="opt-key">C</span>It is denied ‚Äî the SCP is the maximum permissions ceiling and cannot be overridden by any IAM policy in that account</button>
        <button class="kcheck-opt" onclick="check(this,false,1)"><span class="opt-key">D</span>It depends ‚Äî if the IAM admin's role has an explicit Allow, it overrides the SCP Deny</button>
      </div>
      <div class="kcheck-feedback" id="fb-1"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn" onclick="next()">Next Lesson ‚Üí</button></div>
  </div>

  <!-- LESSON 3 -->
  <div class="lesson-pane" id="pane-2">
    <div class="lesson-tag tag-security">Evaluation Logic</div>
    <h1>SCP Evaluation<br><em>Logic</em></h1>
    <p><strong>Objective:</strong> Understand the exact order AWS evaluates policies so you can predict access outcomes.</p>
    <p>AWS evaluates permissions in a strict order. Understanding this order is essential for debugging access issues and for designing effective SCPs.</p>
    <div class="eval-flow">
      <div class="eval-step"><span class="eval-num">1</span><span class="eval-q">Is there an explicit Deny anywhere in any applicable SCP, permission boundary, or IAM policy?</span><span class="eval-result deny">‚Üí DENY</span></div>
      <div class="eval-step"><span class="eval-num">2</span><span class="eval-q">Does an applicable SCP have an Allow for this action? (Is the action within the permissions ceiling?)</span><span class="eval-result next">‚Üí continue</span></div>
      <div class="eval-step"><span class="eval-num">3</span><span class="eval-q">Does an applicable IAM policy (identity or resource) have an explicit Allow?</span><span class="eval-result allow">‚Üí ALLOW</span></div>
      <div class="eval-step"><span class="eval-num">4</span><span class="eval-q">No explicit Allow found anywhere</span><span class="eval-result deny">‚Üí DENY (implicit)</span></div>
    </div>
    <p><strong>Explicit Deny always wins.</strong> This is why a single SCP Deny statement can lock out even the most privileged IAM admin in any member account ‚Äî the Deny fires before the Allow is ever evaluated.</p>
    <div class="callout insight"><div class="callout-title">üí° AWS Default: All Denied</div>AWS uses default-deny. Nothing is allowed unless explicitly permitted. This means new accounts start with almost no access ‚Äî only permissions that are both within the SCP ceiling AND explicitly granted by an IAM policy are allowed.</div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">An SCP allows all actions (<code style="font-family:'IBM Plex Mono',monospace;font-size:12px;background:var(--pill);padding:1px 5px;border-radius:3px;color:var(--violet)">Effect: Allow, Action: *, Resource: *</code>). A developer's IAM role has no permissions policies attached. Can the developer do anything?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,2)"><span class="opt-key">A</span>Yes ‚Äî the SCP allows everything so the developer has full access</button>
        <button class="kcheck-opt" onclick="check(this,true,2)"><span class="opt-key">C</span>No ‚Äî the SCP sets a ceiling but grants nothing. With no IAM Allow, step 3 fails and AWS returns an implicit Deny</button>
        <button class="kcheck-opt" onclick="check(this,false,2)"><span class="opt-key">B</span>Yes ‚Äî an SCP Allow is equivalent to an IAM Allow and grants access directly</button>
        <button class="kcheck-opt" onclick="check(this,false,2)"><span class="opt-key">D</span>Partial ‚Äî the developer can read resources but not write them</button>
      </div>
      <div class="kcheck-feedback" id="fb-2"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn" onclick="next()">Next Lesson ‚Üí</button></div>
  </div>

  <!-- LESSON 4 -->
  <div class="lesson-pane" id="pane-3">
    <div class="lesson-tag tag-ops">Production Patterns</div>
    <h1>Common SCP<br><em>Patterns</em></h1>
    <p><strong>Objective:</strong> Learn the four SCP patterns used in almost every enterprise AWS environment ‚Äî and understand why each matters.</p>
    <table class="styled-table">
      <thead><tr><th>Pattern</th><th>What it prevents</th></tr></thead>
      <tbody>
        <tr><td>Deny public S3 buckets</td><td>Anyone in the account making S3 buckets publicly readable or writable ‚Äî the #1 source of cloud data leaks</td></tr>
        <tr><td>Deny root account usage</td><td>Anyone using root credentials in member accounts ‚Äî forces use of IAM identities</td></tr>
        <tr><td>Region restriction</td><td>Provisioning resources outside approved regions ‚Äî reduces attack surface and ensures data residency compliance</td></tr>
        <tr><td>Protect security tooling</td><td>Anyone disabling GuardDuty, Config, CloudTrail, or Security Hub ‚Äî prevents attackers from turning off detection after compromise</td></tr>
      </tbody>
    </table>
    <p>The "protect security tooling" SCP is especially important. A common attacker playbook after account compromise is to disable GuardDuty and CloudTrail before lateral movement ‚Äî removing the evidence trail. An SCP that denies these actions prevents this even if the attacker has admin credentials.</p>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">JSON ¬∑ SCP: Deny public S3 buckets</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre>{
  <span class="hl">"Effect"</span>: <span class="hl2">"Deny"</span>,
  <span class="hl">"Action"</span>: [
    <span class="hl">"s3:PutBucketAcl"</span>,
    <span class="hl">"s3:PutBucketPublicAccessBlock"</span>
  ],
  <span class="hl">"Resource"</span>: <span class="hl2">"*"</span>,
  <span class="hl">"Condition"</span>: {
    <span class="hl">"StringEquals"</span>: {
      <span class="comment">// Only deny when setting to public</span>
      <span class="hl">"s3:x-amz-acl"</span>: [<span class="hl2">"public-read"</span>, <span class="hl2">"public-read-write"</span>]
    }
  }
}</pre>
    </div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">An attacker gains admin access to a member account and immediately disables GuardDuty to cover their tracks. Which SCP pattern would have prevented this?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,3)"><span class="opt-key">A</span>Region restriction ‚Äî limits where resources can be provisioned</button>
        <button class="kcheck-opt" onclick="check(this,false,3)"><span class="opt-key">B</span>Deny public S3 buckets ‚Äî prevents data exfiltration via storage</button>
        <button class="kcheck-opt" onclick="check(this,true,3)"><span class="opt-key">C</span>Protect security tooling ‚Äî denies actions that disable GuardDuty, Config, or CloudTrail</button>
        <button class="kcheck-opt" onclick="check(this,false,3)"><span class="opt-key">D</span>Deny root usage ‚Äî root credentials can disable security services directly</button>
      </div>
      <div class="kcheck-feedback" id="fb-3"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn lab-btn" onclick="next()">Start Lab ‚Üí</button></div>
  </div>

  <!-- LAB -->
  <div class="lesson-pane lab-pane" id="pane-4">
    <div class="lesson-tag tag-lab">üî¨ Hands-On Lab</div>
    <h1>Deploy an SCP:<br><em>Deny Public S3 Buckets</em></h1>
    <p>You'll create an AWS Organization, write a Service Control Policy that prevents public S3 buckets, and verify it works by attempting to create a public bucket and watching it get blocked.</p>
    <div class="callout lab-note"><div class="callout-title">‚ö° Free Tier Note</div>AWS Organizations is free to use. The management account is your existing account. Member accounts added to the org remain separate ‚Äî their Free Tier limits apply independently.</div>

    <div class="lab-steps">
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">1</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Create Your AWS Organization <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~10 min</span></div>
          <div class="step-body">
            <ol>
              <li>AWS Console ‚Üí search <code>Organizations</code> ‚Üí <strong>AWS Organizations</strong></li>
              <li>Click <strong>Create an organization</strong> ‚Üí <strong>Create organization</strong></li>
              <li>Your current account becomes the Management Account (Root)</li>
              <li>Verify email if prompted (check your inbox for the confirmation email)</li>
              <li>Navigate to <strong>Policies</strong> ‚Üí <strong>Service control policies</strong></li>
              <li>Click <strong>Enable service control policies</strong></li>
            </ol>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">2</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Write and Deploy the SCP <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~20 min</span></div>
          <div class="step-body">
            <ol>
              <li>Organizations ‚Üí Policies ‚Üí Service control policies ‚Üí <strong>Create policy</strong></li>
              <li>Policy name: <code>DenyPublicS3Buckets</code></li>
              <li>Description: <code>Prevent any identity from making S3 buckets publicly accessible</code></li>
              <li>Replace the default policy JSON with:
                <div class="code-block" style="margin-top:10px">
                  <div class="code-header"><span class="code-lang">JSON</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
                  <pre>{
  <span class="hl">"Version"</span>: <span class="hl2">"2012-10-17"</span>,
  <span class="hl">"Statement"</span>: [
    {
      <span class="hl">"Sid"</span>: <span class="hl2">"DenyPublicS3ACLs"</span>,
      <span class="hl">"Effect"</span>: <span class="hl2">"Deny"</span>,
      <span class="hl">"Action"</span>: [
        <span class="hl">"s3:PutBucketAcl"</span>,
        <span class="hl">"s3:PutObjectAcl"</span>
      ],
      <span class="hl">"Resource"</span>: <span class="hl2">"*"</span>,
      <span class="hl">"Condition"</span>: {
        <span class="hl">"StringEquals"</span>: {
          <span class="hl">"s3:x-amz-acl"</span>: [
            <span class="hl2">"public-read"</span>,
            <span class="hl2">"public-read-write"</span>,
            <span class="hl2">"authenticated-read"</span>
          ]
        }
      }
    },
    {
      <span class="hl">"Sid"</span>: <span class="hl2">"DenyDisablePublicAccessBlock"</span>,
      <span class="hl">"Effect"</span>: <span class="hl2">"Deny"</span>,
      <span class="hl">"Action"</span>: <span class="hl2">"s3:PutBucketPublicAccessBlock"</span>,
      <span class="hl">"Resource"</span>: <span class="hl2">"*"</span>,
      <span class="hl">"Condition"</span>: {
        <span class="hl">"StringEquals"</span>: {
          <span class="hl">"s3:PublicAccessBlockConfiguration/BlockPublicAcls"</span>: <span class="hl2">"false"</span>
        }
      }
    }
  ]
}</pre>
                </div>
              </li>
              <li>Click <strong>Create policy</strong></li>
            </ol>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">3</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Attach the SCP to Root <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~5 min</span></div>
          <div class="step-body">
            <ol>
              <li>Organizations ‚Üí <strong>AWS accounts</strong> ‚Üí click <strong>Root</strong></li>
              <li>Click <strong>Policies</strong> tab ‚Üí <strong>Attach</strong></li>
              <li>Select <code>DenyPublicS3Buckets</code> ‚Üí <strong>Attach policy</strong></li>
            </ol>
            <div class="callout warning" style="margin-top:12px;margin-bottom:0"><div class="callout-title">‚ö† Note on Single-Account Orgs</div>In a single-account org (just your management account), SCPs don't restrict the management account itself. To test enforcement, you would need a member account. For now, the policy is deployed ‚Äî the architecture is what matters for your portfolio.</div>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">4</div></div>
        <div class="step-content">
          <div class="step-title">Screenshot &amp; Document <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~10 min</span></div>
          <div class="step-body">
            <ol>
              <li>Screenshot: Organizations ‚Üí Policies ‚Üí your SCP visible in the list</li>
              <li>Screenshot: Root ‚Üí Policies tab showing <code>DenyPublicS3Buckets</code> attached</li>
              <li>Open the policy JSON and screenshot the content</li>
            </ol>
            <div class="callout tip" style="margin-top:12px;margin-bottom:0"><div class="callout-title">‚úì Portfolio Value</div>A deployed SCP with a clear JSON policy and attachment screenshot is more impressive than any certificate claim. It demonstrates you understand the architecture, not just the theory.</div>
          </div>
        </div>
      </div>
    </div>

    <h2 style="font-family:'DM Serif Display',serif;font-size:20px;color:#e4eaf6;margin:32px 0 16px;font-weight:400">Completion Checklist</h2>
    <div class="checklist-progress">
      <div class="checklist-progress-bar"><div class="checklist-progress-fill" id="cl-fill"></div></div>
      <span class="checklist-progress-label" id="cl-label">0 / 6</span>
    </div>
    <div class="checklist">
      <div class="check-item" onclick="toggleCheck(this,0)"><div class="check-box">‚úì</div><div class="check-text">AWS Organization created, management account verified</div></div>
      <div class="check-item" onclick="toggleCheck(this,1)"><div class="check-box">‚úì</div><div class="check-text">Service Control Policies feature enabled</div></div>
      <div class="check-item" onclick="toggleCheck(this,2)"><div class="check-box">‚úì</div><div class="check-text"><code style="font-family:'IBM Plex Mono',monospace;font-size:11px;color:var(--violet)">DenyPublicS3Buckets</code> SCP created with correct JSON</div></div>
      <div class="check-item" onclick="toggleCheck(this,3)"><div class="check-box">‚úì</div><div class="check-text">SCP attached to Organisation Root</div></div>
      <div class="check-item" onclick="toggleCheck(this,4)"><div class="check-box">‚úì</div><div class="check-text">Screenshot of policy in SCP list for portfolio</div></div>
      <div class="check-item" onclick="toggleCheck(this,5)"><div class="check-box">‚úì</div><div class="check-text">Screenshot of Root ‚Üí Policies showing SCP attached</div></div>
    </div>

    <h2 style="font-family:'DM Serif Display',serif;font-size:20px;color:#e4eaf6;margin:32px 0 16px;font-weight:400">Portfolio Commit</h2>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">bash</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre>git add screenshots/day-04-*.png labs/day-04-scp-deny-public-s3.json
git commit -m <span class="hl">"Day 04: AWS Organizations + SCP DenyPublicS3Buckets deployed to Root"</span>
git push</pre>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn lab-btn" onclick="finish()">Complete Day 4 ‚úì</button></div>
  </div>

  <!-- COMPLETION -->
  <div class="lesson-pane" id="pane-complete">
    <div class="completion-card">
      <span class="completion-icon">üèõÔ∏è</span>
      <h1>Day 4 Complete</h1>
      <p>You understand AWS Organizations hierarchy, the critical difference between SCPs and IAM policies, the evaluation order that makes Deny always win, and the four enterprise SCP patterns.</p>
      <div class="score-pill"><span>‚ö°</span> Quiz: <span id="score-val">‚Äî</span></div><br>
      <div class="lab-score-pill"><span>üî¨</span> Lab: <span id="lab-score-val">‚Äî</span> checklist items</div>
      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;margin-top:8px">
        <button class="prev-btn" onclick="goTo(0);resetAll()">‚Ü© Review</button>
        <a href="../index.html" style="text-decoration:none"><button class="next-btn" style="background:var(--pill);color:var(--muted);border:1px solid var(--border-hi)">‚Üê Course Index</button></a>
        <a href="day-05.html" style="text-decoration:none"><button class="next-btn lab-btn">Day 5 ‚Üí</button></a>
      </div>
    </div>
  </div>
</div>
</div>
<script>
const STORAGE_KEY='csm-day04';const TOTAL=5;
const titles=['AWS Organizations Overview','SCPs vs. IAM Policies','SCP Evaluation Logic','Common SCP Patterns','Hands-on: Deploy an SCP'];
const fb={
  0:{good:"Correct. Policies attached to Root inherit downward through the entire hierarchy ‚Äî every OU and every account in the organisation.",bad:"Not quite. Root policies apply to the entire organisation hierarchy. That's the whole point ‚Äî Root is the top-level parent, so its policies cascade down to every OU and account."},
  1:{good:"Correct. An SCP Deny is evaluated before any IAM Allow. The SCP is the permissions ceiling ‚Äî even AdministratorAccess cannot exceed it.",bad:"Not quite. SCPs are the permissions ceiling. Even AdministratorAccess in a member account cannot perform an action that an SCP denies. The SCP Deny takes precedence."},
  2:{good:"Correct. SCPs set the ceiling but don't grant anything. A developer needs an explicit IAM Allow to perform any action ‚Äî and that Allow must also fall within what the SCP permits.",bad:"Not quite. SCPs never grant permissions, only restrict them. Even if an SCP allows all actions, without an IAM policy granting explicit permission, step 3 of the evaluation fails and AWS returns an implicit Deny."},
  3:{good:"Correct. The 'protect security tooling' SCP pattern explicitly denies actions like guardduty:DeleteDetector and cloudtrail:StopLogging ‚Äî preventing attackers from disabling detection after compromise.",bad:"Not quite. Region restriction and public S3 patterns address different threats. Protecting security tooling means denying the ability to disable GuardDuty, CloudTrail, Config, or Security Hub ‚Äî exactly the attacker's next move."}
};
let state=loadState();
function loadState(){try{const s=localStorage.getItem(STORAGE_KEY);if(s)return JSON.parse(s);}catch(e){}return{current:0,done:[],correct:[],answered:[],checks:[]};}
function saveState(){try{localStorage.setItem(STORAGE_KEY,JSON.stringify(state));}catch(e){}}
function goTo(n){document.querySelectorAll('.lesson-pane').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));state.current=n;document.getElementById('pane-'+(n===TOTAL?'complete':n)).classList.add('active');const items=document.querySelectorAll('.nav-item');if(items[n])items[n].classList.add('active');document.getElementById('topbar-title').textContent=titles[n]||'Complete';document.getElementById('btn-prev').disabled=(n===0);document.getElementById('btn-next').disabled=(n>=TOTAL-1);window.scrollTo(0,0);saveState();updateProgress();}
function next(){if(state.current<TOTAL-1)goTo(state.current+1);}function prev(){if(state.current>0)goTo(state.current-1);}
function finish(){markDone(state.current);document.querySelectorAll('.lesson-pane').forEach(p=>p.classList.remove('active'));document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));const pct=Math.round(state.correct.length/4*100);document.getElementById('score-val').textContent=state.correct.length+' / 4 ('+pct+'%)';const checked=state.checks.filter(Boolean).length;document.getElementById('lab-score-val').textContent=checked+' / 6';document.getElementById('pane-complete').classList.add('active');document.getElementById('topbar-title').textContent='Complete';document.getElementById('btn-prev').disabled=true;document.getElementById('btn-next').disabled=true;saveState();}
function markDone(n){if(!state.done.includes(n))state.done.push(n);const items=document.querySelectorAll('.nav-item');if(items[n])items[n].classList.add('done');updateProgress();}
function updateProgress(){const c=state.done.length;document.getElementById('progress-pct').textContent=c+' / '+TOTAL;document.getElementById('progress-fill').style.width=(c/TOTAL*100)+'%';}
function check(btn,isCorrect,idx){if(state.answered.includes(idx))return;state.answered.push(idx);const opts=btn.closest('.kcheck-options').querySelectorAll('.kcheck-opt');opts.forEach(o=>{o.classList.add('disabled');o.style.pointerEvents='none';});const fbEl=document.getElementById('fb-'+idx);if(isCorrect){btn.classList.add('correct');fbEl.className='kcheck-feedback show good';fbEl.textContent='‚úì '+fb[idx].good;if(!state.correct.includes(idx))state.correct.push(idx);}else{btn.classList.add('wrong');fbEl.className='kcheck-feedback show bad';fbEl.textContent='‚úó '+fb[idx].bad;opts.forEach(o=>{if(o.getAttribute('onclick')&&o.getAttribute('onclick').includes('true'))o.classList.add('reveal-correct');});}markDone(idx);saveState();}
function toggleCheck(el,idx){if(!state.checks[idx])state.checks[idx]=false;state.checks[idx]=!state.checks[idx];el.classList.toggle('checked',state.checks[idx]);updateChecklist();saveState();}
function updateChecklist(){const total=6,checked=state.checks.filter(Boolean).length;document.getElementById('cl-fill').style.width=(checked/total*100)+'%';document.getElementById('cl-label').textContent=checked+' / '+total;if(checked===total&&!state.done.includes(4))markDone(4);}
function copyCode(btn){const pre=btn.closest('.code-block').querySelector('pre');navigator.clipboard.writeText(pre.innerText).then(()=>{btn.textContent='copied!';setTimeout(()=>btn.textContent='copy',1500);});}
function resetAll(){state={current:0,done:[],correct:[],answered:[],checks:[]};saveState();document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('done'));document.querySelectorAll('.kcheck-opt').forEach(o=>{o.classList.remove('correct','wrong','reveal-correct','disabled');o.style.pointerEvents='';});document.querySelectorAll('.kcheck-feedback').forEach(f=>{f.className='kcheck-feedback';f.textContent='';});document.querySelectorAll('.check-item').forEach(i=>i.classList.remove('checked'));updateChecklist();updateProgress();goTo(0);}
function restoreState(){state.done.forEach(n=>{const items=document.querySelectorAll('.nav-item');if(items[n])items[n].classList.add('done');});state.answered.forEach(idx=>{const paneEl=document.getElementById('pane-'+idx);if(!paneEl)return;const opts=paneEl.querySelectorAll('.kcheck-opt');opts.forEach(o=>{o.classList.add('disabled');o.style.pointerEvents='none';});const fbEl=document.getElementById('fb-'+idx);if(state.correct.includes(idx)){const co=Array.from(opts).find(o=>o.getAttribute('onclick')&&o.getAttribute('onclick').includes('true'));if(co)co.classList.add('correct');if(fbEl){fbEl.className='kcheck-feedback show good';fbEl.textContent='‚úì '+fb[idx].good;}}else{opts.forEach(o=>{if(o.getAttribute('onclick')&&o.getAttribute('onclick').includes('true'))o.classList.add('reveal-correct');});if(fbEl){fbEl.className='kcheck-feedback show bad';fbEl.textContent='‚úó '+fb[idx].bad;}}});state.checks.forEach((v,i)=>{if(v){const items=document.querySelectorAll('.check-item');if(items[i])items[i].classList.add('checked');}});updateChecklist();updateProgress();goTo(state.current||0);}
restoreState();
</script>
</body>
</html>
