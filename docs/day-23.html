<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Day 23 ‚Äî GuardDuty Threat Intelligence</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="shared.css">
</head>
<body>
<div class="shell">
<nav class="sidebar">
  <div class="sidebar-header">
    <div class="day-badge">Week 4 ¬∑ Day 23</div>
    <h2>GuardDuty<br>Threat Intelligence</h2>
    <div class="sidebar-meta"><span class="chip">GuardDuty</span><span class="chip">ML Detection</span><span class="chip">Threat Intel</span><span class="chip">4 lessons</span></div>
  </div>
  <div class="sidebar-back">
    <a class="back-index" href="../index.html">
      <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M7.5 2L3.5 6L7.5 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Course Index
    </a>
    <div class="week-jumps-label">Jump to week</div>
    <div class="week-jumps">
      <a class="week-jump wj1" href="../index.html#week-1">W1</a>
      <a class="week-jump wj2" href="../index.html#week-2">W2</a>
      <a class="week-jump wj3" href="../index.html#week-3">W3</a>
      <a class="week-jump wj4" href="../index.html#week-4">W4</a>
    </div>
    <div class="day-nav-label">Week 4 days</div>
    <div class="day-nav">
      <a class="day-link" href="day-22.html">D22</a>
      <a class="day-link current" href="day-23.html">D23</a>
      <a class="day-link" href="day-24.html">D24</a>
      <a class="day-link" href="day-25.html">D25</a>
      <a class="day-link" href="day-26.html">D26</a>
      <a class="day-link" href="day-27.html">D27</a>
      <a class="day-link" href="day-28.html">D28</a>
    </div>
  </div>

  <div class="lesson-nav">
    <div class="nav-group-label">Lessons</div>
    <div class="nav-item active" onclick="goTo(0)"><span class="nav-num">01</span><span class="nav-label">How GuardDuty Detects Threats</span><span class="nav-check">‚úì</span></div>
    <div class="nav-item" onclick="goTo(1)"><span class="nav-num">02</span><span class="nav-label">Finding Types: Reconnaissance to Impact</span><span class="nav-check">‚úì</span></div>
    <div class="nav-item" onclick="goTo(2)"><span class="nav-num">03</span><span class="nav-label">Malware & Crypto Mining Detection</span><span class="nav-check">‚úì</span></div>
    <div class="nav-item" onclick="goTo(3)"><span class="nav-num">04</span><span class="nav-label">Triage, Suppression & Response</span><span class="nav-check">‚úì</span></div>
    <div class="nav-group-label" style="margin-top:8px">Lab</div>
    <div class="nav-item lab-item" onclick="goTo(4)"><span class="nav-num" style="color:var(--lab)">üî¨</span><span class="nav-label">Hands-on: Enable GuardDuty + Findings Analysis</span><span class="nav-check">‚úì</span></div>
  </div>
  <div class="sidebar-footer">
    <div class="progress-label"><span>Progress</span><span id="progress-pct">0 / 5</span></div>
    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
  </div>
</nav>
<div class="main">
  <div class="lesson-topbar">
    <div class="lesson-crumb">Day 23 &nbsp;/&nbsp; <span id="topbar-title">How GuardDuty Detects Threats</span></div>
    <div class="nav-arrows">
      <button class="arrow-btn" id="btn-prev" onclick="prev()" disabled>‚Üê Prev</button>
      <button class="arrow-btn" id="btn-next" onclick="next()">Next ‚Üí</button>
    </div>
  </div>

  <!-- LESSON 1 -->
  <div class="lesson-pane active" id="pane-0">
    <div class="lesson-tag tag-security">Threat Detection ¬∑ Foundational</div>
    <h1>How GuardDuty<br><em>Detects Threats</em></h1>
    <p><strong>Objective:</strong> Understand what data sources GuardDuty analyses, how its ML-based behavioural detection works, and what distinguishes it from the rule-based CloudWatch alarms you built yesterday.</p>
    <p>CloudTrail alarms from Day 22 fire on <em>known bad events</em> ‚Äî you explicitly told them what to look for. GuardDuty is different: it <strong>learns your environment's normal behaviour</strong> and fires when something deviates from that baseline ‚Äî even for attack patterns you didn't think to define a rule for.</p>
    <div class="callout insight">
      <div class="callout-title">üí° Three Detection Engines in One</div>
      GuardDuty combines three approaches: (1) <strong>Threat intelligence feeds</strong> ‚Äî known malicious IPs, domains, and file hashes from AWS + third-party feeds (CrowdStrike, Proofpoint). (2) <strong>Anomaly detection ML</strong> ‚Äî behavioural baseline per account/region; flags deviations like "this role never called EC2:RunInstances before" or "this IP never accessed this bucket". (3) <strong>Rule-based signatures</strong> ‚Äî known attack patterns like DNS tunnelling, crypto mining pools, Tor exit nodes.
    </div>
    <table class="styled-table">
      <thead><tr><th>Data Source</th><th>What GuardDuty sees</th><th>Detects</th></tr></thead>
      <tbody>
        <tr><td>CloudTrail</td><td>All management + data events API calls</td><td>Credential theft, privilege escalation, data exfil</td></tr>
        <tr><td>VPC Flow Logs</td><td>Network traffic accept/reject per ENI</td><td>Port scans, C2 beaconing, crypto miner pools</td></tr>
        <tr><td>DNS Logs</td><td>DNS queries from within your VPC</td><td>DNS tunnelling, C2 via DNS, known malware domains</td></tr>
        <tr><td>EKS Audit Logs</td><td>Kubernetes API calls in EKS clusters</td><td>Pod privilege escalation, anomalous exec commands</td></tr>
        <tr><td>S3 Data Events</td><td>Object-level S3 access patterns</td><td>Mass download, cross-account access anomalies</td></tr>
        <tr><td>Malware Scans</td><td>EBS volume snapshots on finding trigger</td><td>Known malware signatures on EC2/ECS</td></tr>
      </tbody>
    </table>
    <div class="callout warning">
      <div class="callout-title">‚ö† 14-Day Baseline Period</div>
      When you first enable GuardDuty, it spends approximately 14 days building a behavioural baseline for your account before anomaly-based detections become reliable. Threat intelligence and rule-based detections (known bad IPs, crypto miners) fire immediately from day one. Don't judge GuardDuty's effectiveness in the first two weeks.
    </div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">GuardDuty generates a finding: <code>UnauthorizedAccess:IAMUser/TorIPCaller</code>. Your team says the developer regularly uses a VPN, so this is a false positive. What should you do?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,0)"><span class="opt-key">A</span>Disable GuardDuty's Tor detection rule ‚Äî it's too noisy in environments with VPN users</button>
        <button class="kcheck-opt" onclick="check(this,true,0)"><span class="opt-key">B</span>Investigate first ‚Äî confirm the developer's VPN exit IP matches a known Tor exit node (not just any VPN), verify the developer was working at that time, then create a suppression rule scoped to that IP + the specific user ARN if confirmed legitimate</button>
        <button class="kcheck-opt" onclick="check(this,false,0)"><span class="opt-key">C</span>Archive the finding ‚Äî VPN usage commonly triggers this and it's almost always a false positive</button>
        <button class="kcheck-opt" onclick="check(this,false,0)"><span class="opt-key">D</span>No action needed ‚Äî GuardDuty findings are informational only and don't require triage</button>
      </div>
      <div class="kcheck-feedback" id="fb-0"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" disabled>‚Üê Previous</button><button class="next-btn" onclick="next()">Next Lesson ‚Üí</button></div>
  </div>

  <!-- LESSON 2 -->
  <div class="lesson-pane" id="pane-1">
    <div class="lesson-tag tag-threat">Finding Types ¬∑ Foundational</div>
    <h1>Finding Types:<br><em>Reconnaissance to Impact</em></h1>
    <p><strong>Objective:</strong> Read and interpret GuardDuty finding types using the MITRE ATT&CK kill-chain ‚Äî from initial reconnaissance through to data exfiltration and impact ‚Äî so you can triage by attack stage, not just severity score.</p>
    <p>GuardDuty finding names follow a structured format: <code>ThreatPurpose:ResourceType/ThreatFamilyName.DetectionMechanism!Artifact</code>. Once you understand the naming convention, you can diagnose what stage of an attack is in progress without reading the full description.</p>

    <div class="finding-card">
      <div class="finding-header"><span class="finding-type">Recon:EC2/PortProbeUnprotectedPort</span><span class="sev-badge sev-medium">MEDIUM</span></div>
      <div class="finding-body"><strong>Attack stage: Reconnaissance (TA0043)</strong>Something is scanning your EC2 instance's open ports from a known malicious IP. The instance has a port accessible from the internet that isn't behind a load balancer. This is often automated scanning ‚Äî low signal alone, high signal if followed by exploitation findings.</div>
    </div>
    <div class="finding-card">
      <div class="finding-header"><span class="finding-type">UnauthorizedAccess:IAMUser/ConsoleLoginSuccess.B</span><span class="sev-badge sev-high">HIGH</span></div>
      <div class="finding-body"><strong>Attack stage: Initial Access (TA0001)</strong>A console login succeeded from an unusual location or device. The ".B" suffix means GuardDuty's ML model flagged the login as anomalous against this user's historical pattern ‚Äî different country, different ASN, different time of day. Credential stuffing or account takeover in progress.</div>
    </div>
    <div class="finding-card">
      <div class="finding-header"><span class="finding-type">PrivilegeEscalation:IAMUser/AdministrativePermissions</span><span class="sev-badge sev-high">HIGH</span></div>
      <div class="finding-body"><strong>Attack stage: Privilege Escalation (TA0004)</strong>An IAM entity that previously had limited permissions has attempted to enumerate or assume administrative-level access. Common pattern: attacker with developer credentials probing for privilege escalation paths before full compromise.</div>
    </div>
    <div class="finding-card">
      <div class="finding-header"><span class="finding-type">Exfiltration:S3/AnomalousBehavior</span><span class="sev-badge sev-critical">CRITICAL</span></div>
      <div class="finding-body"><strong>Attack stage: Exfiltration (TA0010)</strong>A principal is accessing S3 objects at a volume or rate significantly higher than their established baseline. This is GuardDuty's ML model firing ‚Äî not a rule. The principal exists in your account and has legitimate access, but something changed dramatically. Active data exfiltration pattern.</div>
    </div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">GuardDuty fires three findings in sequence over 4 hours on the same EC2 instance: <code>Recon:EC2/PortProbeUnprotectedPort</code> (Medium), then <code>UnauthorizedAccess:EC2/SSHBruteForce</code> (High), then <code>Backdoor:EC2/C&CActivity.B</code> (High). How should you interpret this sequence?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,1)"><span class="opt-key">A</span>Three unrelated events ‚Äî each should be triaged independently with no assumed connection</button>
        <button class="kcheck-opt" onclick="check(this,true,1)"><span class="opt-key">B</span>A complete attack progression: reconnaissance ‚Üí initial access attempt ‚Üí successful compromise with C2 establishment. The instance is likely compromised and calling back to an attacker-controlled server. Isolate immediately</button>
        <button class="kcheck-opt" onclick="check(this,false,1)"><span class="opt-key">C</span>False positives ‚Äî port probes and SSH brute force are common internet noise and the C2 finding is likely a VPN connection</button>
        <button class="kcheck-opt" onclick="check(this,false,1)"><span class="opt-key">D</span>The first two are noise but the C2 finding alone warrants investigation</button>
      </div>
      <div class="kcheck-feedback" id="fb-1"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn" onclick="next()">Next Lesson ‚Üí</button></div>
  </div>

  <!-- LESSON 3 -->
  <div class="lesson-pane" id="pane-2">
    <div class="lesson-tag tag-security">Malware & Crypto ¬∑ Intermediate</div>
    <h1>Malware & Crypto<br><em>Mining Detection</em></h1>
    <p><strong>Objective:</strong> Understand how GuardDuty detects crypto miners and malware ‚Äî the two most common threats in cloud environments ‚Äî and what the findings tell you about the attack's stage and blast radius.</p>
    <p>Crypto mining is the most financially motivated cloud attack. Attackers compromise accounts, spin up GPU/CPU-heavy instances in multiple regions, and mine cryptocurrency at the account owner's expense. A fully-provisioned crypto mining operation can cost $50,000+ per month before detection. GuardDuty's ML identifies mining pool communication patterns within hours.</p>
    <div class="finding-card">
      <div class="finding-header"><span class="finding-type">CryptoCurrency:EC2/BitcoinTool.B!DNS</span><span class="sev-badge sev-high">HIGH</span></div>
      <div class="finding-body"><strong>What it means:</strong> The EC2 instance is making DNS queries to domains associated with cryptocurrency mining pools. The <code>!DNS</code> suffix identifies the data source (DNS logs). The instance is either compromised by a miner or running unauthorised mining software. Check: what processes are running, what launched them, when the instance was last patched.</div>
    </div>
    <div class="finding-card">
      <div class="finding-header"><span class="finding-type">Execution:EC2/MaliciousFile</span><span class="sev-badge sev-critical">CRITICAL</span></div>
      <div class="finding-body"><strong>What it means:</strong> GuardDuty's malware protection scanned an EBS volume and found a file matching a known malware signature. This triggers automatically when GuardDuty detects suspicious activity on an instance ‚Äî it takes an EBS snapshot and scans it without interrupting the running instance. The finding includes the file path, hash, and malware family name.</div>
    </div>
    <div class="callout tip">
      <div class="callout-title">‚úì GuardDuty Malware Protection ‚Äî How It Works</div>
      When GuardDuty detects suspicious network or API behaviour on an EC2 instance, it can automatically initiate a malware scan: (1) Creates an EBS snapshot of the instance volume, (2) Mounts the snapshot in an isolated GuardDuty-managed account, (3) Scans with signature + heuristic detection, (4) Deletes the snapshot regardless of result. This is fully agentless ‚Äî nothing is installed on your instance. Enable it under GuardDuty ‚Üí Protection Plans ‚Üí Malware Protection.
    </div>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">bash ‚Äî list GuardDuty findings by severity</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre><span class="comment"># Get detector ID first</span>
DETECTOR=$(aws guardduty list-detectors --query <span class="str">'DetectorIds[0]'</span> --output text)

<span class="comment"># List HIGH and CRITICAL findings (severity >= 7.0)</span>
aws guardduty list-findings \
  --detector-id $DETECTOR \
  --finding-criteria <span class="str">'{"Criterion":{"severity":{"Gte":7}}}'</span> \
  --query <span class="str">'FindingIds'</span>

<span class="comment"># Get full details of specific findings</span>
aws guardduty get-findings \
  --detector-id $DETECTOR \
  --finding-ids <span class="str">"finding-id-here"</span> \
  --query <span class="str">'Findings[*].{Type:Type,Severity:Severity,Resource:Resource.ResourceType,IP:Service.Action.NetworkConnectionAction.RemoteIpDetails.IpAddressV4}'</span></pre>
    </div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">GuardDuty fires <code>CryptoCurrency:EC2/BitcoinTool.B!DNS</code> on an instance in <code>ap-southeast-2</code> ‚Äî a region your team doesn't normally use. What two things should you check immediately?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,2)"><span class="opt-key">A</span>Check GuardDuty's false positive rate for this finding type and file a suppression rule if it exceeds 10%</button>
        <button class="kcheck-opt" onclick="check(this,true,2)"><span class="opt-key">B</span>Check (1) who launched the instance ‚Äî CloudTrail RunInstances in ap-southeast-2 for the past 30 days (compromised credential or insider?), and (2) what other regions have unusual EC2 activity ‚Äî crypto miners typically spin up across many regions simultaneously</button>
        <button class="kcheck-opt" onclick="check(this,false,2)"><span class="opt-key">C</span>Check the instance's security group ‚Äî the finding is likely caused by overly permissive inbound rules</button>
        <button class="kcheck-opt" onclick="check(this,false,2)"><span class="opt-key">D</span>Check the IAM credentials attached to the instance ‚Äî mining software requires elevated permissions to run</button>
      </div>
      <div class="kcheck-feedback" id="fb-2"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn" onclick="next()">Next Lesson ‚Üí</button></div>
  </div>

  <!-- LESSON 4 -->
  <div class="lesson-pane" id="pane-3">
    <div class="lesson-tag tag-ops">Triage & Response ¬∑ Intermediate</div>
    <h1>Triage, Suppression<br><em>& Response</em></h1>
    <p><strong>Objective:</strong> Build a repeatable finding triage workflow ‚Äî severity ‚Üí context ‚Üí decision ‚Äî and know when to suppress vs investigate vs escalate. Understand how GuardDuty integrates with EventBridge for automated response.</p>
    <p>A GuardDuty deployment with no triage process becomes noise. The goal is a workflow where every finding gets a decision within its SLA ‚Äî Critical in 15 minutes, High in 1 hour, Medium in 4 hours ‚Äî not buried in a queue.</p>
    <div class="callout insight">
      <div class="callout-title">üí° The 3-Question Triage Framework</div>
      For every finding, answer three questions before deciding: (1) <strong>Is this a known legitimate pattern?</strong> (NAT gateway, security scanner, your pen test team) ‚Üí suppression candidate. (2) <strong>Is the affected resource high value?</strong> (production DB, PCI data bucket, admin role) ‚Üí escalate regardless of severity. (3) <strong>Is there a companion finding?</strong> (finding + same resource in recent history = kill chain) ‚Üí treat as incident, not an alert.
    </div>
    <table class="styled-table">
      <thead><tr><th>Finding Severity</th><th>SLA</th><th>Default Action</th></tr></thead>
      <tbody>
        <tr><td>Critical (9.0+)</td><td>15 minutes</td><td>Auto-isolate (SG change via Lambda) + page on-call</td></tr>
        <tr><td>High (7.0‚Äì8.9)</td><td>1 hour</td><td>Notify security team Slack channel + open incident ticket</td></tr>
        <tr><td>Medium (4.0‚Äì6.9)</td><td>4 hours</td><td>Triage queue ‚Äî investigate during business hours</td></tr>
        <tr><td>Low (1.0‚Äì3.9)</td><td>24 hours</td><td>Log and trend ‚Äî watch for volume spikes</td></tr>
      </tbody>
    </table>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">JSON ‚Äî EventBridge rule: route critical GuardDuty findings to Lambda</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre>{
  <span class="key">"source"</span>: [<span class="str">"aws.guardduty"</span>],
  <span class="key">"detail-type"</span>: [<span class="str">"GuardDuty Finding"</span>],
  <span class="key">"detail"</span>: {
    <span class="hl2">"severity"</span>: [{ <span class="str">"numeric"</span>: [<span class="str">">="</span>, <span class="key">9.0</span>] }]
  }
}
<span class="comment">// Route to Lambda that: isolates SG + notifies Slack + creates ticket</span>
<span class="comment">// This is the SOAR pattern ‚Äî covered in depth on Day 26</span></pre>
    </div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">GuardDuty fires a High finding daily for your NAT Gateway's IP appearing in threat intel feeds (it routes all outbound traffic). You've confirmed this is the NAT Gateway. What's the correct response?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,3)"><span class="opt-key">A</span>Disable the threat intelligence feature for your account ‚Äî the NAT Gateway IP is causing too much noise</button>
        <button class="kcheck-opt" onclick="check(this,true,3)"><span class="opt-key">B</span>Create a suppression rule scoped to: finding type = this specific type AND resource = the NAT Gateway's Elastic IP. This silences the false positive without broadly disabling the detection for real threats from other IPs</button>
        <button class="kcheck-opt" onclick="check(this,false,3)"><span class="opt-key">C</span>Archive each finding manually as it arrives ‚Äî suppression rules are too broad and may hide real threats</button>
        <button class="kcheck-opt" onclick="check(this,false,3)"><span class="opt-key">D</span>Replace the NAT Gateway with a different IP ‚Äî GuardDuty findings indicate the IP is permanently blocklisted</button>
      </div>
      <div class="kcheck-feedback" id="fb-3"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn lab-btn" onclick="next()">Start Lab ‚Üí</button></div>
  </div>

  <!-- LAB -->
  <div class="lesson-pane" id="pane-4">
    <div class="lesson-tag tag-lab">üî¨ Hands-On Lab</div>
    <h1>Enable GuardDuty +<br><em>Findings Analysis</em></h1>
    <p>Enable GuardDuty with malware protection, generate a sample finding using GuardDuty's built-in test, analyse the finding JSON structure, and document a findings analysis report for your portfolio.</p>
    <div class="callout lab-note"><div class="callout-title">‚ö° Cost Note</div>GuardDuty: first 30 days free trial. After trial: ~$4/month for a small account (quantity-based pricing on CloudTrail events + flow logs). For this lab, the free trial covers everything. Disable GuardDuty after the lab if you don't want ongoing charges ‚Äî but consider keeping it active since it's your primary threat detection layer.</div>
    <div class="lab-steps">
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">1</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Enable GuardDuty with All Protection Plans <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~5 min</span></div>
          <div class="step-body">
            <ol>
              <li>GuardDuty Console ‚Üí Get started ‚Üí Enable GuardDuty</li>
              <li>Protection plans ‚Üí Enable: <strong>S3 Protection</strong>, <strong>Malware Protection for EC2</strong>, <strong>RDS Protection</strong></li>
              <li>Note your Detector ID from Settings ‚Äî you'll need it for CLI commands</li>
            </ol>
            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash ‚Äî verify GuardDuty is active</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre>aws guardduty list-detectors
aws guardduty get-detector \
  --detector-id <span class="hl2">YOUR_DETECTOR_ID</span> \
  --query <span class="str">'{Status:Status,Features:Features[*].Name}'</span></pre>
            </div>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">2</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Generate Sample Findings <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~5 min</span></div>
          <div class="step-body">
            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash ‚Äî generate one of every finding type (safe ‚Äî sample data only)</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre>aws guardduty create-sample-findings \
  --detector-id <span class="hl2">YOUR_DETECTOR_ID</span> \
  --finding-types \
    <span class="str">"UnauthorizedAccess:IAMUser/TorIPCaller"</span> \
    <span class="str">"CryptoCurrency:EC2/BitcoinTool.B!DNS"</span> \
    <span class="str">"Backdoor:EC2/C&CActivity.B!DNS"</span> \
    <span class="str">"Recon:EC2/PortProbeUnprotectedPort"</span></pre>
            </div>
            <p>Wait 30 seconds, then refresh the GuardDuty Findings console ‚Äî you'll see sample findings for all four types.</p>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">3</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Analyse Finding JSON Structure <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~10 min</span></div>
          <div class="step-body">
            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash ‚Äî export findings to JSON for portfolio</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre><span class="comment"># Get all finding IDs</span>
FINDINGS=$(aws guardduty list-findings \
  --detector-id <span class="hl2">YOUR_DETECTOR_ID</span> \
  --query <span class="str">'FindingIds'</span> --output json)

<span class="comment"># Export full finding details</span>
aws guardduty get-findings \
  --detector-id <span class="hl2">YOUR_DETECTOR_ID</span> \
  --finding-ids $(echo $FINDINGS | jq -r '.[]' | tr '\n' ' ') \
  > portfolio/week4/day23-guardduty-findings.json

<span class="comment"># Quick summary table</span>
aws guardduty get-findings \
  --detector-id <span class="hl2">YOUR_DETECTOR_ID</span> \
  --finding-ids $(echo $FINDINGS | jq -r '.[]' | tr '\n' ' ') \
  --query <span class="str">'Findings[*].{Type:Type,Sev:Severity,Region:Region}'</span> \
  --output table</pre>
            </div>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">4</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Build Findings Analysis Report <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~15 min</span></div>
          <div class="step-body">
            <p>Create <code>portfolio/week4/day23-findings-analysis.md</code> with a triage table for each sample finding:</p>
            <ul style="padding-left:20px;color:#a0a8bc;font-size:14px;line-height:2">
              <li>Finding type + severity</li>
              <li>MITRE ATT&CK tactic + technique</li>
              <li>Immediate response action (per your SLA table)</li>
              <li>Suppression criteria if false positive</li>
            </ul>
            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash ‚Äî commit</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre>git add portfolio/week4/day23-*.{json,md} screenshots/day-23*.png
git commit -m <span class="str">"Day 23: GuardDuty enabled, sample findings generated, triage analysis complete"</span>
git push</pre>
            </div>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">5</div></div>
        <div class="step-content">
          <div class="step-title">Create a Suppression Rule <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~5 min</span></div>
          <div class="step-body">
            <ol>
              <li>GuardDuty Console ‚Üí Findings ‚Üí Filter by type <code>Recon:EC2/PortProbeUnprotectedPort</code></li>
              <li>Actions ‚Üí Create suppression rule ‚Äî name it <code>lab-sample-suppression</code></li>
              <li>Criteria: finding type = PortProbeUnprotectedPort AND <code>service.userFeedback = FALSE_POSITIVE</code></li>
              <li>Screenshot the suppression rule ‚Äî demonstrates false positive management in your portfolio</li>
            </ol>
          </div>
        </div>
      </div>
    </div>
    <h2 style="font-family:'DM Serif Display',serif;font-size:20px;color:#e4eaf6;margin:32px 0 16px;font-weight:400">Lab Checklist</h2>
    <div class="checklist-progress"><div class="checklist-progress-bar"><div class="checklist-progress-fill" id="cl-fill"></div></div><span class="checklist-progress-label" id="cl-label">0 / 7</span></div>
    <div class="checklist">
      <div class="check-item" onclick="toggleCheck(this,0)"><div class="check-box">‚úì</div><div class="check-text">GuardDuty enabled with S3 Protection + Malware Protection + RDS Protection active</div></div>
      <div class="check-item" onclick="toggleCheck(this,1)"><div class="check-box">‚úì</div><div class="check-text">4 sample findings generated and visible in GuardDuty Findings console</div></div>
      <div class="check-item" onclick="toggleCheck(this,2)"><div class="check-box">‚úì</div><div class="check-text">Findings exported to <code>day23-guardduty-findings.json</code> in portfolio</div></div>
      <div class="check-item" onclick="toggleCheck(this,3)"><div class="check-box">‚úì</div><div class="check-text">Findings analysis report completed with MITRE mapping and triage decisions for all 4 finding types</div></div>
      <div class="check-item" onclick="toggleCheck(this,4)"><div class="check-box">‚úì</div><div class="check-text">Suppression rule created for PortProbe false positive ‚Äî screenshot in portfolio</div></div>
      <div class="check-item" onclick="toggleCheck(this,5)"><div class="check-box">‚úì</div><div class="check-text">GuardDuty console screenshot showing active detectors + protection plans</div></div>
      <div class="check-item" onclick="toggleCheck(this,6)"><div class="check-box">‚úì</div><div class="check-text">All artefacts committed to <code>portfolio/week4/</code></div></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn lab-btn" onclick="finish()">Complete Day 23 ‚úì</button></div>
  </div>

  <!-- COMPLETION -->
  <div class="lesson-pane" id="pane-complete">
    <div class="completion-card">
      <span class="completion-icon">üõ°Ô∏è</span>
      <h1>Day 23 Complete</h1>
      <p>GuardDuty is your ML-powered watchdog ‚Äî continuously analysing 6 data sources for threats you didn't know to look for. Tomorrow: Security Hub CNAPP ‚Äî unifying all your Week 4 signals into one risk dashboard.</p>
      <div class="score-pill"><span>‚ö°</span> Quiz: <span id="score-val">‚Äî</span></div><br>
      <div class="lab-score-pill"><span>üî¨</span> Lab: <span id="lab-score-val">‚Äî</span> complete</div>
      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
        <a href="day-22.html" style="text-decoration:none"><button class="prev-btn">‚Üê Day 22</button></a>
        <a href="day-24.html" style="text-decoration:none"><button class="next-btn">Day 24 ‚Üí</button></a>
      </div>
    </div>
  </div>
</div>
</div>
<script src="csm-core.js"></script>
<script>
initPage({
  storageKey: 'csm-day23',
  total: 5,
  quizCount: 4,
  checkTotal: 7,
  titles: ['How GuardDuty Detects Threats','Finding Types: Reconnaissance to Impact','Malware & Crypto Mining Detection','Triage, Suppression & Response','Hands-on: Enable GuardDuty + Findings Analysis'],
  fb: {
  0:{good:"Correct. The key word is 'Tor' ‚Äî this is specifically a Tor exit node, not just any VPN IP. A regular VPN won't trigger this finding. Before creating any suppression rule, confirm it's actually the developer's known VPN exit node and not a real Tor connection. Then scope the suppression tightly: this finding type + this specific user ARN + this IP range. A broad suppression ('disable Tor detection') would hide real attacker activity using Tor for anonymity.",bad:"Not quite. This finding is specific to Tor exit nodes, not generic VPN IPs ‚Äî confirm that the developer's VPN actually routes through a Tor exit node before treating this as a false positive. The correct response is always investigate first, then suppress with a tightly-scoped rule if confirmed legitimate. Archiving manually every time is operationally unsustainable. Disabling the Tor detection rule account-wide would remove protection against real Tor-based attacks."},
  1:{good:"Correct. Three findings on the same resource in sequence tell a kill-chain story: port probe (attacker scanned and found an open port) ‚Üí SSH brute force (attacker tried to authenticate) ‚Üí C2 activity (attacker succeeded and established command-and-control). This is a textbook progression from MITRE TA0043 ‚Üí TA0001 ‚Üí TA0011. The instance is almost certainly compromised. Immediate actions: isolate with security group change, take EBS snapshot for forensics, rotate any credentials on or accessible from the instance.",bad:"Not quite. The sequence matters enormously. Three findings on the same resource over 4 hours is a kill-chain progression, not coincidence: reconnaissance confirmed an open port, brute force gained access, and C2 activity confirms the attacker has a foothold and is talking to a command server. Treating these as unrelated would leave a compromised instance active on your network. Always correlate findings on the same resource within a time window ‚Äî it's how you distinguish an incident from an alert."},
  2:{good:"Correct. Two critical immediate checks: (1) CloudTrail in ap-southeast-2 for RunInstances ‚Äî who launched this instance? If it's a role or user that doesn't normally operate in that region, you have credential compromise. Check the source IP of the API call. (2) Cross-region scope ‚Äî crypto miners are almost always multi-region operations. Check CloudTrail and GuardDuty in every region for similar activity. An instance in one unusual region is rarely the full picture.",bad:"Not quite. The security group doesn't explain crypto mining DNS queries ‚Äî the instance is communicating outbound to mining pools, not receiving inbound attacks. IAM permissions don't explain it either ‚Äî mining software doesn't need elevated AWS permissions to mine. The critical questions are: who launched this instance in a region your team doesn't use (compromised credential?), and is there similar activity in other regions (how widespread is the compromise)?"},
  3:{good:"Correct. Suppression rules are the right tool for known-legitimate patterns. The key is scoping: suppress exactly (this finding type) AND (this specific NAT Gateway EIP) ‚Äî not broadly disabling threat intelligence for the whole account. This way the detection still fires for all other IPs, and only the confirmed false positive pattern is silenced. Document the suppression rule with a business justification so future engineers know why it exists.",bad:"Not quite. Disabling threat intelligence entirely removes protection for all IPs, not just your NAT Gateway. Manually archiving every daily finding is unsustainable ‚Äî that's what suppression rules are built for. Replacing the NAT Gateway IP doesn't help ‚Äî the new IP could also appear in threat intel feeds, and this misunderstands what the finding means (it means traffic is routing through a flagged IP, which your NAT Gateway does legitimately). Create a scoped suppression rule."}
}
});
</script>
</body>
</html>
