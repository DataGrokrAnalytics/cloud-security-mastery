<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Day 13 ‚Äî JIT & Cross-Account Access</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=DM+Serif+Display:ital@0;1&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="shared.css">
</head>
<body>
<div class="shell">
<nav class="sidebar">
  <div class="sidebar-header">
    <div class="day-badge">Week 2 ¬∑ Day 13</div>
    <h2>JIT &amp; Cross-Account<br>Access</h2>
    <div class="sidebar-meta"><span class="chip">JIT</span><span class="chip">STS</span><span class="chip">4 lessons</span><span class="chip">1 lab</span></div>
  </div>
  <div class="sidebar-back">
    <a class="back-index" href="../index.html">
      <svg width="12" height="12" viewBox="0 0 12 12" fill="none"><path d="M7.5 2L3.5 6L7.5 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
      Course Index
    </a>
    <div class="week-jumps-label">Jump to week</div>
    <div class="week-jumps">
      <a class="week-jump wj1" href="../index.html#week-1">W1</a>
      <a class="week-jump wj2" href="../index.html#week-2">W2</a>
      <a class="week-jump wj3" href="../index.html#week-3">W3</a>
      <a class="week-jump wj4" href="../index.html#week-4">W4</a>
    </div>
    <div class="day-nav-label">Week 2 days</div>
    <div class="day-nav">
      <a class="day-link" href="day-08.html">D8</a>
      <a class="day-link" href="day-09.html">D9</a>
      <a class="day-link" href="day-10.html">D10</a>
      <a class="day-link" href="day-11.html">D11</a>
      <a class="day-link" href="day-12.html">D12</a>
      <a class="day-link current" href="day-13.html">D13</a>
      <a class="day-link" href="day-14.html">D14</a>
    </div>
  </div>

  <div class="lesson-nav">
    <div class="nav-group-label">Lessons</div>
    <div class="nav-item active" onclick="goTo(0)"><span class="nav-num">01</span><span class="nav-label">Standing vs. Temporary Access</span><span class="nav-check">‚úì</span></div>
    <div class="nav-item" onclick="goTo(1)"><span class="nav-num">02</span><span class="nav-label">AWS STS &amp; AssumeRole</span><span class="nav-check">‚úì</span></div>
    <div class="nav-item" onclick="goTo(2)"><span class="nav-num">03</span><span class="nav-label">Cross-Account Role Trusts</span><span class="nav-check">‚úì</span></div>
    <div class="nav-item" onclick="goTo(3)"><span class="nav-num">04</span><span class="nav-label">JIT Policy Patterns</span><span class="nav-check">‚úì</span></div>
    <div class="nav-group-label" style="margin-top:8px">Lab</div>
    <div class="nav-item lab-item" onclick="goTo(4)"><span class="nav-num" style="color:var(--lab)">üî¨</span><span class="nav-label">Hands-on: 1-Hour TTL Sessions</span><span class="nav-check">‚úì</span></div>
  </div>
  <div class="sidebar-footer">
    <div class="progress-label"><span>Progress</span><span id="progress-pct">0 / 5</span></div>
    <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
  </div>
</nav>
<div class="main">
  <div class="lesson-topbar">
    <div class="lesson-crumb">Day 13 &nbsp;/&nbsp; <span id="topbar-title">Standing vs. Temporary Access</span></div>
    <div class="nav-arrows">
      <button class="arrow-btn" id="btn-prev" onclick="prev()" disabled>‚Üê Prev</button>
      <button class="arrow-btn" id="btn-next" onclick="next()">Next ‚Üí</button>
    </div>
  </div>

  <!-- LESSON 1 -->
  <div class="lesson-pane active" id="pane-0">
    <div class="lesson-tag tag-concept">Core Concept</div>
    <h1>Standing vs.<br><em>Temporary Access</em></h1>
    <p><strong>Objective:</strong> Understand why long-lived IAM credentials are a persistent security risk, and why temporary credentials with a short TTL eliminate an entire class of attack.</p>
    <p><strong>Standing access</strong> means a user or service has permissions that exist continuously ‚Äî 24/7, 365 days a year ‚Äî whether or not they're actively needed. An IAM user with access keys is the classic example: those keys work until they're rotated or deleted.</p>
    <p><strong>Just-In-Time (JIT) access</strong> means credentials are issued only when needed and expire automatically after a short window ‚Äî typically 15 minutes to 1 hour.</p>
    <div class="ttl-comparison">
      <div class="ttl-card"><div class="ttl-label">IAM User Keys</div><div class="ttl-val bad">‚àû</div><div class="ttl-desc">Never expire. Valid until manually rotated. Stolen key = persistent attacker foothold.</div></div>
      <div class="ttl-card"><div class="ttl-label">STS Default</div><div class="ttl-val ok">12h</div><div class="ttl-desc">Default STS token duration. Better than permanent, but a 12-hour window is still significant.</div></div>
      <div class="ttl-card"><div class="ttl-label">JIT Pattern</div><div class="ttl-val good">1h</div><div class="ttl-desc">Credential expires in 1 hour. Stolen token is worthless after expiry. Industry best practice.</div></div>
    </div>
    <div class="callout insight"><div class="callout-title">üí° The Maths of Temporary Credentials</div>If an attacker steals a permanent IAM access key and you don't notice for 30 days, they had 720 hours of undetected access. If they steal a 1-hour STS token, their window is at most 60 minutes ‚Äî then the credential is worthless. Shortening TTL doesn't prevent credential theft; it minimises the damage window.</div>
    <div class="callout breach"><div class="callout-title">Real-World: The CI/CD Leak Pattern</div>The most common source of AWS credential leaks is CI/CD pipelines accidentally committing long-lived IAM access keys to public GitHub repositories. With JIT credentials, there are no long-lived keys in the pipeline ‚Äî the pipeline requests a temporary token when it runs, uses it, and the token expires. Nothing to leak.</div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">A developer accidentally commits AWS access keys to a public GitHub repo. They notice after 4 hours and immediately rotates the keys. How long did the attacker have valid credentials?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,0)"><span class="opt-key">A</span>0 minutes ‚Äî GitHub automatically detects and revokes AWS credentials committed to public repos</button>
        <button class="kcheck-opt" onclick="check(this,true,0)"><span class="opt-key">B</span>Up to 4 hours ‚Äî until the keys were rotated, they were fully valid. (GitHub does notify AWS, but the keys must be explicitly revoked.)</button>
        <button class="kcheck-opt" onclick="check(this,false,0)"><span class="opt-key">C</span>Indefinitely ‚Äî even after rotation, old keys remain valid for 24 hours for backward compatibility</button>
        <button class="kcheck-opt" onclick="check(this,false,0)"><span class="opt-key">D</span>Until the developer noticed ‚Äî GitHub doesn't expose repository contents to the public immediately</button>
      </div>
      <div class="kcheck-feedback" id="fb-0"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" disabled>‚Üê Previous</button><button class="next-btn" onclick="next()">Next Lesson ‚Üí</button></div>
  </div>

  <!-- LESSON 2 -->
  <div class="lesson-pane" id="pane-1">
    <div class="lesson-tag tag-concept">Service Deep Dive</div>
    <h1>AWS STS &amp;<br><em>AssumeRole</em></h1>
    <p><strong>Objective:</strong> Understand how the AWS Security Token Service (STS) works and how AssumeRole generates temporary credentials.</p>
    <p>AWS <strong>Security Token Service (STS)</strong> is the AWS service that issues temporary security credentials. When you assume a role, STS returns three things: an Access Key ID, a Secret Access Key, and a Session Token ‚Äî all temporary, all expiring at the same time.</p>
    <div class="sts-flow">
      <div class="sts-step"><div class="sts-num">1</div><div class="sts-body"><strong>Principal calls sts:AssumeRole</strong> ‚Äî passing the ARN of the role they want to assume and optionally a session duration (15m‚Äì12h, default 1h) and a session name for audit trails.</div></div>
      <div class="sts-step"><div class="sts-num">2</div><div class="sts-body"><strong>STS validates the trust policy</strong> ‚Äî the target role's trust policy must explicitly allow the calling principal to assume it. If not, the call fails with an Access Denied.</div></div>
      <div class="sts-step"><div class="sts-num">3</div><div class="sts-body"><strong>STS evaluates the permission policy</strong> ‚Äî the calling principal must have <code>sts:AssumeRole</code> permission on the target role ARN (in their identity policy).</div></div>
      <div class="sts-step"><div class="sts-num">4</div><div class="sts-body"><strong>STS returns temporary credentials</strong> ‚Äî AccessKeyId, SecretAccessKey, SessionToken, and Expiration. Valid for the requested duration, then permanently invalid.</div></div>
    </div>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">bash ‚Äî AssumeRole Example</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre><span class="comment"># Assume a role for exactly 1 hour (3600 seconds)</span>
aws sts assume-role \
  --role-arn <span class="str">"arn:aws:iam::123456789012:role/ProdReadOnly"</span> \
  --role-session-name <span class="str">"alice-prod-audit-2026-02-23"</span> \
  --duration-seconds <span class="hl">3600</span>

<span class="comment"># Returns:</span>
{
  <span class="key">"Credentials"</span>: {
    <span class="key">"AccessKeyId"</span>: <span class="str">"ASIAIOSFODNN7EXAMPLE"</span>,
    <span class="key">"SecretAccessKey"</span>: <span class="str">"wJalrXUtnFEMI/..."</span>,
    <span class="key">"SessionToken"</span>: <span class="str">"AQoXnyc4lcK4..."</span>,
    <span class="hl2">"Expiration"</span>: <span class="str">"2026-02-23T11:30:00Z"</span>  <span class="comment">‚Üê 1 hour from now</span>
  }
}</pre>
    </div>
    <div class="callout tip"><div class="callout-title">‚úì Session Name for Audit</div>The session name appears in CloudTrail logs for every API call made with these credentials. Use a descriptive format: <code>username-environment-date-purpose</code>. This gives you a complete audit trail: "alice assumed ProdReadOnly at 10:30 for a production audit, and here are all the API calls she made."</div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">A developer assumes the <code>ProductionDeploy</code> role with a 1-hour session. They start a deployment at 10:00. At 11:05 they try to run another deployment command. What happens?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,1)"><span class="opt-key">A</span>The command succeeds ‚Äî AWS extends sessions automatically if they're still in use</button>
        <button class="kcheck-opt" onclick="check(this,true,1)"><span class="opt-key">B</span>The command fails with an ExpiredTokenException ‚Äî the session token expired at 11:00 and must be renewed by calling AssumeRole again</button>
        <button class="kcheck-opt" onclick="check(this,false,1)"><span class="opt-key">C</span>The command is queued and runs once the developer re-authenticates within the same session</button>
        <button class="kcheck-opt" onclick="check(this,false,1)"><span class="opt-key">D</span>The session is extended for another hour automatically because it was still in use when it expired</button>
      </div>
      <div class="kcheck-feedback" id="fb-1"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn" onclick="next()">Next Lesson ‚Üí</button></div>
  </div>

  <!-- LESSON 3 -->
  <div class="lesson-pane" id="pane-2">
    <div class="lesson-tag tag-security">Architecture</div>
    <h1>Cross-Account<br><em>Role Trusts</em></h1>
    <p><strong>Objective:</strong> Understand how cross-account role assumption works, and why it's the standard pattern for multi-account AWS environments.</p>
    <p>In a multi-account setup (which every organisation running AWS at scale uses), engineers have IAM identities in one account ‚Äî the <strong>identity account</strong> ‚Äî and need to access resources in other accounts (prod, staging, dev). Cross-account role trusts make this possible without creating IAM users in every account.</p>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">JSON ‚Äî Trust Policy in the Target Account (Production)</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre><span class="comment">// This policy is attached to the ProdReadOnly role in account 999888777</span>
{
  <span class="key">"Version"</span>: <span class="str">"2012-10-17"</span>,
  <span class="key">"Statement"</span>: [{
    <span class="hl">"Effect"</span>: <span class="str">"Allow"</span>,
    <span class="hl">"Principal"</span>: {
      <span class="comment">// Only IAM users/roles in the identity account can assume this role</span>
      <span class="str">"AWS"</span>: <span class="str">"arn:aws:iam::111222333:root"</span>
    },
    <span class="hl">"Action"</span>: <span class="str">"sts:AssumeRole"</span>,
    <span class="hl2">"Condition"</span>: {
      <span class="comment">// Additionally require MFA to assume this role</span>
      <span class="str">"Bool"</span>: { <span class="str">"aws:MultiFactorAuthPresent"</span>: <span class="str">"true"</span> }
    }
  }]
}</pre>
    </div>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">JSON ‚Äî Identity Policy in the Identity Account (grants engineers permission to assume)</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre>{
  <span class="key">"Version"</span>: <span class="str">"2012-10-17"</span>,
  <span class="key">"Statement"</span>: [{
    <span class="hl">"Effect"</span>: <span class="str">"Allow"</span>,
    <span class="hl">"Action"</span>: <span class="str">"sts:AssumeRole"</span>,
    <span class="hl">"Resource"</span>: [
      <span class="str">"arn:aws:iam::999888777:role/ProdReadOnly"</span>,
      <span class="str">"arn:aws:iam::555444333:role/StagingDeploy"</span>
    ]
  }]
}</pre>
    </div>
    <p>Both policies are required ‚Äî the trust policy says "I trust these principals", and the identity policy says "this principal can assume these roles". Both gates must pass.</p>
    <div class="callout tip"><div class="callout-title">‚úì The Confused Deputy Problem</div>Always scope trust policies as tightly as possible. Trusting <code>arn:aws:iam::111222333:root</code> (whole account) is broader than trusting <code>arn:aws:iam::111222333:role/SeniorEngineer</code> (specific role). Use the minimum trust scope, and add MFA conditions on production roles.</div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">A developer in the identity account (111222333) tries to assume the <code>ProdAdmin</code> role in the production account (999888777). They get an AccessDenied error. They have <code>sts:AssumeRole</code> in their identity policy. What's the most likely cause?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,2)"><span class="opt-key">A</span>STS doesn't support cross-account role assumption ‚Äî each account needs its own IAM users</button>
        <button class="kcheck-opt" onclick="check(this,true,2)"><span class="opt-key">B</span>The <code>ProdAdmin</code> role's trust policy doesn't list the developer's account or identity as a trusted principal ‚Äî both policies must pass</button>
        <button class="kcheck-opt" onclick="check(this,false,2)"><span class="opt-key">C</span>The developer needs AdministratorAccess in their own account before they can assume roles in other accounts</button>
        <button class="kcheck-opt" onclick="check(this,false,2)"><span class="opt-key">D</span>Cross-account access requires a VPC peering connection between the two accounts</button>
      </div>
      <div class="kcheck-feedback" id="fb-2"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn" onclick="next()">Next Lesson ‚Üí</button></div>
  </div>

  <!-- LESSON 4 -->
  <div class="lesson-pane" id="pane-3">
    <div class="lesson-tag tag-ops">Policy Patterns</div>
    <h1>JIT Policy<br><em>Patterns</em></h1>
    <p><strong>Objective:</strong> Learn practical JIT patterns ‚Äî how to enforce time limits, require MFA, and use conditions to constrain when and how roles can be assumed.</p>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">JSON ‚Äî JIT Role: MFA Required + Time Window</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre>{
  <span class="key">"Version"</span>: <span class="str">"2012-10-17"</span>,
  <span class="key">"Statement"</span>: [{
    <span class="hl">"Effect"</span>: <span class="str">"Allow"</span>,
    <span class="hl">"Action"</span>: <span class="str">"sts:AssumeRole"</span>,
    <span class="hl">"Resource"</span>: <span class="str">"arn:aws:iam::999888777:role/ProdDeploy"</span>,
    <span class="hl2">"Condition"</span>: {
      <span class="comment">// MFA must have been used in the last 30 minutes</span>
      <span class="str">"NumericLessThan"</span>: {
        <span class="str">"aws:MultiFactorAuthAge"</span>: <span class="str">"1800"</span>
      },
      <span class="comment">// Only allow assumption during business hours (UTC)</span>
      <span class="str">"DateGreaterThan"</span>: { <span class="str">"aws:CurrentTime"</span>: <span class="str">"2000-01-01T08:00:00Z"</span> },
      <span class="str">"DateLessThan"</span>: { <span class="str">"aws:CurrentTime"</span>: <span class="str">"2000-01-01T18:00:00Z"</span> }
    }
  }]
}</pre>
    </div>
    <div class="code-block">
      <div class="code-header"><span class="code-lang">bash ‚Äî Requesting a 1-Hour JIT Session</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
      <pre><span class="comment"># Request a 1-hour production access token</span>
aws sts assume-role \
  --role-arn <span class="str">"arn:aws:iam::999888777:role/ProdDeploy"</span> \
  --role-session-name <span class="str">"alice-deploy-$(date +%Y%m%d-%H%M)"</span> \
  --duration-seconds <span class="hl">3600</span> \
  --serial-number <span class="str">"arn:aws:iam::111222333:mfa/alice"</span> \
  --token-code <span class="str">"123456"</span>

<span class="comment"># Export credentials for use in the shell session</span>
export AWS_ACCESS_KEY_ID=<span class="hl2">$(...)
</span>export AWS_SECRET_ACCESS_KEY=<span class="hl2">$(...)
</span>export AWS_SESSION_TOKEN=<span class="hl2">$(...)</span>

<span class="comment"># At 11:05 (after 1hr), any AWS command will return:</span>
<span class="comment"># An error occurred (ExpiredTokenException)</span></pre>
    </div>
    <div class="callout warning"><div class="callout-title">‚ö† Session Duration Limits</div>The maximum session duration for a role is configured on the role itself (IAM ‚Üí Roles ‚Üí Edit ‚Üí Maximum session duration). Even if you request 12 hours, if the role's max is 1 hour, you'll get 1 hour. For highly privileged roles, set the maximum to 1 hour to enforce JIT access at the infrastructure level.</div>
    <div class="kcheck">
      <div class="kcheck-label">Knowledge Check</div>
      <div class="kcheck-q">Your production deployment role has <code>MaxSessionDuration</code> set to 3600 seconds (1 hour). A developer requests a session with <code>--duration-seconds 7200</code> (2 hours). What happens?</div>
      <div class="kcheck-options">
        <button class="kcheck-opt" onclick="check(this,false,3)"><span class="opt-key">A</span>STS grants a 2-hour session ‚Äî the duration request overrides the role's maximum</button>
        <button class="kcheck-opt" onclick="check(this,true,3)"><span class="opt-key">B</span>The request fails with a <code>ValidationError</code> ‚Äî the requested duration exceeds the role's maximum session duration</button>
        <button class="kcheck-opt" onclick="check(this,false,3)"><span class="opt-key">C</span>STS grants exactly 1 hour silently ‚Äî it automatically caps to the role's maximum without error</button>
        <button class="kcheck-opt" onclick="check(this,false,3)"><span class="opt-key">D</span>STS grants 2 hours, but the role's permissions are suspended after 1 hour</button>
      </div>
      <div class="kcheck-feedback" id="fb-3"></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn lab-btn" onclick="next()">Start Lab ‚Üí</button></div>
  </div>

  <!-- LAB -->
  <div class="lesson-pane lab-pane" id="pane-4">
    <div class="lesson-tag tag-lab">üî¨ Hands-On Lab</div>
    <h1>1-Hour TTL<br><em>Sessions</em></h1>
    <p>Create a JIT IAM role with a 1-hour maximum session duration, assume it with a scoped session name, verify the temporary credentials, then confirm expiry behaviour.</p>
    <div class="callout lab-note"><div class="callout-title">‚ö° This is a Single-Account Lab</div>You don't need two AWS accounts to practice JIT. We'll create a role in your account and assume it from your own IAM user ‚Äî this tests all the same mechanics as cross-account access.</div>
    <div class="lab-steps">
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">1</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Create the JIT Role <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~10 min</span></div>
          <div class="step-body">
            <ol>
              <li>IAM ‚Üí Roles ‚Üí Create role ‚Üí <strong>Custom trust policy</strong></li>
              <li>Trust policy: allow your IAM user ARN to assume the role</li>
              <li>Attach policy: <code>AmazonS3ReadOnlyAccess</code> (scoped permissions)</li>
              <li>Name: <code>JIT-S3-ReadOnly-1h</code></li>
              <li>After creation: Edit ‚Üí <strong>Maximum session duration: 1 hour</strong></li>
            </ol>
            <div class="code-block">
              <div class="code-header"><span class="code-lang">JSON ‚Äî Trust Policy Template</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre>{
  <span class="key">"Version"</span>: <span class="str">"2012-10-17"</span>,
  <span class="key">"Statement"</span>: [{
    <span class="hl">"Effect"</span>: <span class="str">"Allow"</span>,
    <span class="hl">"Principal"</span>: {
      <span class="str">"AWS"</span>: <span class="str">"arn:aws:iam::YOUR_ACCOUNT_ID:user/YOUR_IAM_USERNAME"</span>
    },
    <span class="hl">"Action"</span>: <span class="str">"sts:AssumeRole"</span>
  }]
}</pre>
            </div>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">2</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Assume the Role &amp; Inspect Credentials <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~10 min</span></div>
          <div class="step-body">
            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre><span class="comment"># Assume the JIT role</span>
aws sts assume-role \
  --role-arn <span class="str">"arn:aws:iam::YOUR_ACCOUNT_ID:role/JIT-S3-ReadOnly-1h"</span> \
  --role-session-name <span class="str">"jit-lab-$(date +%Y%m%d-%H%M)"</span> \
  --duration-seconds 3600

<span class="comment"># Note the Expiration timestamp in the output</span>
<span class="comment"># It should be exactly 1 hour from now</span>

<span class="comment"># Verify who you are with these credentials</span>
aws sts get-caller-identity</pre>
            </div>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">3</div><div class="step-connector"></div></div>
        <div class="step-content">
          <div class="step-title">Verify Permission Scope <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~5 min</span></div>
          <div class="step-body">
            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre><span class="comment"># With the assumed role credentials ‚Äî this should work</span>
aws s3 ls

<span class="comment"># This should fail ‚Äî role only has S3 read, not EC2</span>
aws ec2 describe-instances
<span class="comment"># Expected: An error occurred (UnauthorizedOperation)</span></pre>
            </div>
          </div>
        </div>
      </div>
      <div class="lab-step">
        <div class="step-num-wrap"><div class="step-num">4</div></div>
        <div class="step-content">
          <div class="step-title">Find the Session in CloudTrail <span style="font-size:12px;color:var(--muted);font-family:'IBM Plex Mono',monospace">~5 min</span></div>
          <div class="step-body">
            <ol>
              <li>CloudTrail ‚Üí Event history ‚Üí Filter by: Event name = <code>AssumeRole</code></li>
              <li>Find your session ‚Äî note the <code>roleSessionName</code> in the event details</li>
              <li>Screenshot this event ‚Äî it's your audit trail proof</li>
            </ol>
            <div class="code-block">
              <div class="code-header"><span class="code-lang">bash</span><button class="copy-btn" onclick="copyCode(this)">copy</button></div>
              <pre>git add screenshots/day-13-*.png
git commit -m "Day 13: JIT ‚Äî 1h TTL session proven, CloudTrail AssumeRole event captured"
git push</pre>
            </div>
          </div>
        </div>
      </div>
    </div>
    <h2 style="font-family:'DM Serif Display',serif;font-size:20px;color:#e4eaf6;margin:32px 0 16px;font-weight:400">Lab Checklist</h2>
    <div class="checklist-progress"><div class="checklist-progress-bar"><div class="checklist-progress-fill" id="cl-fill"></div></div><span class="checklist-progress-label" id="cl-label">0 / 6</span></div>
    <div class="checklist">
      <div class="check-item" onclick="toggleCheck(this,0)"><div class="check-box">‚úì</div><div class="check-text">JIT role <code>JIT-S3-ReadOnly-1h</code> created with MaxSessionDuration = 3600s</div></div>
      <div class="check-item" onclick="toggleCheck(this,1)"><div class="check-box">‚úì</div><div class="check-text"><code>sts:assume-role</code> called successfully ‚Äî Expiration timestamp noted</div></div>
      <div class="check-item" onclick="toggleCheck(this,2)"><div class="check-box">‚úì</div><div class="check-text"><code>aws sts get-caller-identity</code> shows the assumed role ARN (not original user)</div></div>
      <div class="check-item" onclick="toggleCheck(this,3)"><div class="check-box">‚úì</div><div class="check-text">S3 list succeeds; EC2 describe fails ‚Äî permission scope verified</div></div>
      <div class="check-item" onclick="toggleCheck(this,4)"><div class="check-box">‚úì</div><div class="check-text">AssumeRole event found in CloudTrail with session name visible</div></div>
      <div class="check-item" onclick="toggleCheck(this,5)"><div class="check-box">‚úì</div><div class="check-text">GitHub commit pushed with CloudTrail screenshot</div></div>
    </div>
    <div class="lesson-nav-footer"><button class="prev-btn" onclick="prev()">‚Üê Previous</button><button class="next-btn lab-btn" onclick="finish()">Complete Day 13 ‚úì</button></div>
  </div>

  <!-- COMPLETION -->
  <div class="lesson-pane" id="pane-complete">
    <div class="completion-card">
      <span class="completion-icon">‚è±Ô∏è</span>
      <h1>Day 13 Complete</h1>
      <p>You've implemented Just-In-Time access ‚Äî the single most effective control for reducing the blast radius of compromised credentials.</p>
      <div class="score-pill"><span>‚ö°</span> Quiz: <span id="score-val">‚Äî</span></div><br>
      <div class="lab-score-pill"><span>üî¨</span> Lab: <span id="lab-score-val">‚Äî</span> complete</div>
      <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap">
        <a href="../index.html" style="text-decoration:none"><button class="prev-btn">‚Üê Course Index</button></a>
        <a href="day-14.html" style="text-decoration:none"><button class="next-btn">Day 14 ‚Üí</button></a>
      </div>
    </div>
  </div>
</div>
</div>
<script src="csm-core.js"></script>
<script>
initPage({
  storageKey: 'csm-day13',
  total: 5,
  quizCount: 4,
  checkTotal: 6,
  titles: ['Standing vs. Temporary Access','AWS STS & AssumeRole','Cross-Account Role Trusts','JIT Policy Patterns','Hands-on: 1-Hour TTL Sessions'],
  fb: {
  0:{good:"Correct. IAM access keys remain valid until explicitly rotated or deleted. GitHub does have a secret scanning feature that notifies AWS, but the keys must still be deactivated ‚Äî they're not automatically invalidated. 4 hours of exposure is enough for an attacker to create new IAM users, exfiltrate data, or deploy persistent backdoors.",bad:"Not quite. GitHub's secret scanning can detect and alert, but it doesn't automatically revoke AWS credentials ‚Äî that requires action in the AWS console or CLI. The keys were valid for the full 4 hours until manually rotated. With JIT credentials, even if leaked, they'd be worthless within an hour."},
  1:{good:"Correct. STS temporary credentials have a hard expiry ‚Äî they're cryptographically invalid after the Expiration timestamp. There's no automatic renewal. The developer must call sts:AssumeRole again to get a fresh set of credentials for continued access.",bad:"Not quite. STS sessions never auto-extend ‚Äî this is a feature, not a limitation. The hard expiry is exactly what makes temporary credentials safer than permanent keys. When credentials expire, they expire permanently ‚Äî any AWS API call will return ExpiredTokenException and a new AssumeRole call is needed."},
  2:{good:"Correct. AssumeRole requires BOTH gates to pass: the target role's trust policy must allow the calling principal (so the target account controls who can assume their roles), AND the caller must have sts:AssumeRole permission for that specific role ARN in their identity policy. The developer has the identity policy but the trust policy isn't configured.",bad:"Not quite. STS cross-account role assumption is the standard mechanism for multi-account AWS ‚Äî it absolutely works. The error almost certainly comes from the trust policy. Both conditions must be true: the caller has sts:AssumeRole in their identity policy, AND the role's trust policy lists them as a trusted principal."},
  3:{good:"Correct. STS validates the requested duration against the role's MaxSessionDuration. If the request exceeds the maximum, the API call fails immediately with a ValidationError. The role's MaxSessionDuration is a hard ceiling ‚Äî you cannot override it from the caller side. This is what makes it an enforceable JIT control.",bad:"Not quite. STS does not silently cap the session duration or partially grant it ‚Äî it returns a ValidationError if the requested duration exceeds MaxSessionDuration. This is an important distinction: setting MaxSessionDuration to 3600 on the role guarantees no session exceeds 1 hour, regardless of what callers request."}
}
});
</script>
</body>
</html>
